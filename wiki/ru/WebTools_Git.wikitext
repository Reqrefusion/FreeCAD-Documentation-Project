<languages/>

{{GuiCommand/ru
|Name=WebTools Git‏‎
|Name/ru=WebTools Git‏‎
|MenuLocation=Web Tools → Git
|Workbenches=[[WebTools_Workbench/ru|WebTools - ВебИнструменты]]
|Version=0.17
}}

{{VeryImportantMessage|Начиная с FreeCAD v0.17, этот инструмент был удалён из Верстака Arch и теперь является частью внешнего [[WebTools_Workbench/ru|Верстака WebTools (ВебИнструменты)]], который вы можете установить через меню Инструменты → [[Image:AddonManager.svg|24px]] [[Std_AddonMgr/ru|Менеджер дополнений]].
}}

<span id="Description"></span>
== Описание ==

Этот инструмент позволяет тебе управлять документом используя [https://ru.wikipedia.org/wiki/Git_%28software%29 Git]. Git является мощной системой контроля версий, которая может управлять различными версиями файлов и отслеживать их изменения.

Git довольно сложный инструмент, тебе лучше изучить его основы, перед использованием этого инструмента, чтобы избежать потерь данных. Всеобъемлющая литература о Git легко находится в интернете.

'''Необходимое условие:''' Чтобы иметь возможность пользоваться данным инструментом, пакет [https://github.com/gitpython-developers/GitPython gitpython] должен быть установлен в твоей системе. В большинстве linux дистрибутивов, gitpython есть в стандартном репозитории под названием ''gitpython'' или ''python-git''.

<span id="Usage"></span>
==Применение==

# Убедись, что [[Report_view/ru|панель Просмотра отчёта]] открыта, так как сообщения Git будут печататься в ней.
# Сохрани текущий активный документ, убедившись, что сохранённый файл находится в существующем git-хранилище. Он может находиться в подкаталоге.
# Выбери меню {{MenuCommand|Web Tools → [[Image:WebTools_Git.svg|16px]] [[WebTools_Git/ru|Git]]}}
# Это откроет [[Task_panel/ru|Панель задач]] в [[Combo_view/ru|Комбо виде]].

<span id="Options"></span>
== Параметры ==

[[Image:Arch Git panel.jpg|thumb|Вкладка Задачи с интерфейсом Git]]

* Кнопка '''Log''' вызывает диалог, показывающий последние записи в журнале. Вывод соответствует {{Incode|git log}}.
* Кнопка '''Refresh''' повторно просканирует хранилище на предмет изменённых файлов. После сохранения работы необходимо выполнить обновление вручную.
* Кнопка '''Diff''' покажет различия между текущей версией выбранного файла и последней версией, хранящейся в репозитории. Вывод соответствует {{Incode|git diff}}.
** По умолчанию выполняется бинарный diff, для текстового diff-а необходимо настроить инструмент {{Incode|fcinfo}}.
* Кнопка '''Select all''' выделит все файлы для фиксации.
* Кнопка ''Commit''' зафиксирует выбранные файлы. Не забудьте написать сообщение о фиксации, описывающее изменения, которые вы регистрируете.
* Кнопка '''Pull''' будет '''загружать''' все новые изменения в хранилище с выбранного удалённого компьютера. Если файл, открытый в данный момент в FreeCAD, изменяется в результате извлечения, то появится предупреждение, и вы сможете либо сохранить файл снова, либо сохранить его в другом месте.
* Кнопка '''Push''' будет '''загружать''' ваши последние фиксации на выбранный удалённый компьютер.

<span id="Limitations"></span>
== Ограничения ==

* The tool cannot create new repositories yet. You must have an existing local repository already created. (FreeCAD will check if the current document file is inside a Git repository.)
* The tool cannot change or create branches. You must do that manually with standard Git tools.

==Enabling human-readable diffs for FCStd files with the fcinfo utility==

FreeCAD's [[File_Format_FCStd|FCStd file format]] is a zip-based binary format, for which Git cannot produce proper diffs. This means that you cannot see what has changed between one version and another, and also that each new version stored in the Git repository is a full copy of the file.

Although the second problem currently has no solution, the first one can be solved with a little tool available from the FreeCAD source code, called [https://github.com/FreeCAD/FreeCAD/blob/master/src/Tools/fcinfo fcinfo].  Git can be told to use the fcinfo utility to print a human-friendly report of a FCStd file, and, when asked to produce a diff between two FCStd files, will produce a diff between the two fcinfo reports instead. Please note that this is only visual feedback,  a full copy of the file will still be stored internally.

Example of a diff produced with fcinfo:

{{Code|code=
diff --git a/testhouse.FcStd b/testhouse.FcStd
index 08077b6..985b1d8 100644
--- a/testhouse.FcStd
+++ b/testhouse.FcStd
@@ -1,26 +1,25 @@
-Document: /tmp/43un09_testhouse.FcStd (442K)
-   SHA1: 67c1985a45d93cba57d5bf44490897aba460100d
+Document: /tmp/zfXoDd_testhouse.FcStd (370K)
+   SHA1: db1cb5fca18af7bfdca849028f40550df4d845cb
    Comment : This is a test house to showcase FreeCAD's BIM worflow and IFC export capabilities
    Company : uncreated.net
    CreatedBy : Yorik van Havre
    CreationDate : Fri May  9 12:05:54 2014 
    FileVersion : 1
    Id : 
-   Label : testhouse
-   LastModifiedBy : Yorik van Havre
-   LastModifiedDate : 2016-06-28T17:05:57-03:00
+   Label : testhouse2
+   LastModifiedBy : Yorik van Havre
+   LastModifiedDate : Sat Sep 13 20:46:36 2014
+
    License : CC-BY 3.0
    LicenseURL : http://creativecommons.org/licenses/by/3.0/
-   ProgramVersion : 0.17R7800 (Git)
-   TipName : 
+   ProgramVersion : 0.15R3989 (Git)
    Uid : 67e62d8a-6674-4358-92fe-615443be887a
-   Objects: (231)
+   Objects: (221)
        Annotation : Drawing::FeatureViewAnnotation
        Annotation001 : Drawing::FeatureViewAnnotation
        Annotation002 : Drawing::FeatureViewAnnotation
        Annotation003 : Drawing::FeatureViewAnnotation
-       Annotation004 : Drawing::FeatureViewAnnotation
-       Annotation005 : Drawing::FeatureViewAnnotation
        Array : Part::FeaturePython (9K)
        Box : Part::Box (2K)
        Building : App::DocumentObjectGroupPython
@@ -110,7 +109,7 @@ Document: /tmp/43un09_testhouse.FcStd (442K)
        Floor : App::DocumentObjectGroupPython
        Floor001 : App::DocumentObjectGroupPython
        Floor002 : App::DocumentObjectGroupPython
-       Frame : Part::FeaturePython (89K)
}}

Each FreeCAD file contains a SHA1 checksum number, which will change each time the file is saved, even if no contents was changed. So fcinfo will always print something, no matter of the contents changes.

To enable the use of fcinfo (Linux and Mac only - TODO: add Windows instructions)

=== Using fcinfo on a single Git repository ===

These are the steps to enable the use of fcinfo tool in a repository basis.
* Save the fcinfo file somewhere in your system path.
: Note: Since 2023-12-09, on Arch Linux systems the {{Incode|fcinfo}} script is included on {{Incode|freecad}} package, [https://gitlab.archlinux.org/archlinux/packaging/packages/freecad/-/commit/4419bfbfdb670abebd7f2e6ed93194e819781f7d patch here].
* Make it executable.
:  Note: Since 2023-12-09, on Arch Linux systems the {{Incode|fcinfo}} is available at {{Incode|/usr/bin/fcinfo}}.
* Create a {{Incode|.gitattributes}} file in your Git repository and add the following line in it:

: {{Code|lang=text|code=
*.FCStd diff=fcinfo
}}

* Add the following lines to the {{Incode|.gitconfig}} file in your home directory:

: {{Code|lang=text|code=
[diff "fcinfo"]
textconv = /path/to/fcinfo
}}

* Alternatively, if you want to invoke fcinfo with arguments (e.g., {{Incode|--gui}}) use [https://stackoverflow.com/questions/55601430/how-to-pass-a-filename-argument-gitconfig-diff-textconv this approach]:

: {{Code|lang=text|code=
[diff "fcinfo"]
textconv = sh -c '/path/to/fcinfo --gui "$0"'XD
}}

Note that if you are working in a collaborative project you may want to include the fcinfo tool in your repository, in that case the path is relative to your Git repository root directory.

=== Enabling fcinfo globally ===

If you are working on many projects that need fcinfo tool you can enable it globally for your user.
* Create a {{Incode|$HOME/.config/git/attributes}} file and add the following line on it:

: {{Code|lang=text|code=
*.FCStd diff=fcinfo
}}

* Add the following lines to the {{Incode|$HOME/.config/git/config}} file:
** It's equivalent command is {{Incode|git config --global diff.fcinfo.textconv "/path/to/fcinfo"}}.
** Arch Linux users using {{Incode|freecad}} package can use {{Incode|textconv = fcinfo}} since it's already installed on their system.

: {{Code|lang=text|code=
[diff "fcinfo"]
textconv = /path/to/fcinfo
}}

Note that any configuration made in a repository basis overrides global configurations.