<languages/>

{{TutorialInfo/ru
|Topic=Руководство по портированию файлов проекта Wikihouse в FreeCAD
|Level=Intermediate/Advanced
|Time=60 минут
|Author=
|FCVersion=
|Files=
}}

<span id="Introduction"></span>
== Вступление ==

В данном руководстве показано, как конвертировать [https://sketchup.com SketchUp] файлы, используемые в проекте [https://wikihouse.cc Wikihouse] в FreeCAD, с помощью инструментов [[Arch_Panel/ru|Архитектурных панелей]]. В результате должна получится полная копия исходного файла SketchUp, за исключением того, что он станет полностью параметрическим. Уровень параметризации конечного файла зависит от количества затраченной на него работы, как описано ниже. Но вполне возможно делать всё шаг за шагом и довольно быстро перестроить файл Wikihouse, а более длительное преобразование базовых профилей в эскизы оставить на потом.

Этот учебник требует промежуточных знаний FreeCAD, то есть вы уже можете ориентироваться в различных верстаках и инструментах, умеете моделировать простые объекты и, прежде всего, хорошо владеете инструментами [[Draft_Move/ru|Набросок Переместить]] и [[Draft_Rotate/ru|Набросок Повернуть]]. В основном будут использоваться инструменты Верстаков [[Draft_Workbench/ru|Набросок (Draft)]] и [[Arch_Workbench/ru|Архитектура (Arch)]], но знание [[Sketcher_Workbench/ru|Верстака Скетчер (Sketcher)]] станет необходимым при преобразовании базовых профилей в эскизы.

Поскольку проект Wikihouse является открытым по своей природе, файлы легко найти на сайте проекта, а также на [https://3dwarehouse.sketchup.com/search.html?q=wikihouse&backendClass=both SketchUp 3D Warehouse] или в репозиториях проекта [https://github.com/wikihouseproject github]. Предпочтительным форматом, используемым проектом, является Sketchup, поэтому большинство файлов, которые вы найдёте, будут в этом формате.

В следующем руководстве мы использовали файл [https://github.com/wikihouseproject/Microhouse/blob/master/microhouse_0.5_chassis.skp Chassis] из подпроекта Wikihouse's Microhouse (Вики-домик Микро-дом).

<span id="Preparing_the_Sketchup_file"></span>
== Подготовка файла Sketchup ==

Первое, что нужно сделать, это открыть файл в SketchUp и удалить все, что вы не хотите экспортировать. Мы будем экспортировать только одну часть Микро-дома, поэтому все остальное должно быть удалено.

[[Image:Arch_Wikihouse_05.jpg]]

Элементы Вики-домики в SketchUp создаются особым образом: Складывая небольшие "кусочки" вместе, вы создаёте различные компоненты:

[[Image:Arch_Wikihouse_06.jpg]]

Во FreeCAD мы будем действовать иначе. Поскольку одной из самых мощных возможностей FreeCAD является [[Sketcher_Workbench/ru|Ограниченные Эскизы]], нам лучше воспользоваться этим преимуществом и построить все элементы нашего Вики-домика на основе Эскизов. Таким образом, изменение любой детали можно будет производить в [[Sketcher_Workbench/ru|Верстаке Скетчер]], что гораздо удобнее.

Чтобы превратить наши объекты SketchUp в эскизы FreeCAD, которые затем можно использовать для создания объектов [[Arch_Panel/ru|Архитектурных Панелей]], нам нужно извлечь одну плоскую грань из каждой детали Вики-домика. Толщина будет добавлена позже, в FreeCAD, непосредственно в свойствах Архитектурной Панели. Таким образом, мы сохраним параметричность. Чтобы превратить каждый компонент Вики-домика в одну плоскую грань, войдите в каждый компонент, дважды щёлкнув по нему, затем выделите каждый подкомпонент и нажмите правую кнопку мыши → Разрушить (Explode), пока все подкомпоненты не будут разрушены, и ваш компонент будет состоять только из граней и рёбер:

[[Image:Arch_Wikihouse_08.jpg]]

После этого выделите все элементы компонента и снимите выделение, дважды щёлкнув Shift + двойной щелчок, с каждой фронтальной грани компонента. Обязательно дважды, а не один раз, потому что в противном случае вы снимите выделение только с лицевой стороны, но не с её граней (которые нам тоже нужно будет сохранить). После этого мы выделим всё, что хотим сохранить, поэтому нам останется только нажать клавишу delete. Теперь наш компонент - это всего лишь одна большая плоская грань.

[[Image:Arch_Wikihouse_07.jpg]]

Повторите это для каждого компонента. Поскольку многие из них дублируются, это не такая большая задача, как кажется. Кроме того, если вы не знакомы с системой Вики-домик, этот шаг даст вам довольно хорошее понимание того, как она работает.

Когда наш дом полностью состоит из плоских элементов, мы можем выделить все и экспортировать в файл .dae, а затем импортировать этот файл в FreeCAD. Не забудьте отметить опцию "triangulate all - триангулировать всё".

<span id="Solving_the_double_faces_bug"></span>
== Решение проблемы дублирования граней ==

Есть одна неприятная проблема, для которой я не нашёл лучшего решения: У сетки, экспортированной из SketchUp в формат .dae, дублируются грани. Каждая грань становится фактически двумя гранями. Самый простой способ, который я нашёл на данный момент, - открыть экспортированный файл в [https://blender.org Blender] для исправления:

# Откройте файл dae в Blender ({{MenuCommand|Файл → Импорт → Collada (Коллада)}})
# Выберите компонент и нажмите {{Button|TAB}}, чтобы войти в режим редактирования.
# Нажмите {{Button|A}}, чтобы отменить выделение всего, затем {{Button|A}} снова, чтобы выделить всё.
# Нажмите {{Button|W}} → Удалить дубликаты
# Нажмите {{Button|TAB}}, чтобы выйти из режима редактирования.
# Повторите для всех компонентов
# Сохраните новый файл [[Arch DAE/ru|DAE]] ({{MenuCommand|Файл → Экспорт → Collada/Коллада}})

Обычно вышеописанная операция не изменяет масштаб, но всегда стоит проверить, используя измерительные инструменты, что импортированная геометрия имеет правильный масштаб, прежде чем продолжать. При необходимости вам может потребоваться изменить настройки экспорта Collada/Коллада в Blender.

<span id="Importing_and_converting_to_wires"></span>
== Импорт и преобразование в ломанные кривые ==

Обратите внимание, что может быть проще работать по частям и обрабатывать + экспортировать объекты по группам, как мы сделали ниже, мы экспортировали только первый слой, состоящий из жёлтых элементов в SketchUp. Эти элементы попадут в FreeCAD как объекты [[Mesh_Workbench/ru|Сетки (Mesh)]]:

[[Image:Arch_Wikihouse_09.jpg]]

Следующим шагом будет создание ломанных кривых из каждой нашей сетки. Существует удобный макрос [[Macro_Extract_Wires_from_Mesh/ru|Макрос Извлечение Ломанных из сетки (Extract Wires from Mesh)]], который делает именно это. Установите его (инструкции см. на странице [[Macros/ru|Макросы]]), а затем по очереди (можно и все сразу, но этот макрос требует некоторого времени) преобразуйте все наши сетки в объекты ломанных кривых:

[[Image:Arch_Wikihouse_10.jpg]]

<div lang="en" dir="ltr" class="mw-content-ltr">
We could now already make [[Arch_Panel|Arch Panel]] objects from each of these wire-like objects, simply by selecting them and pressing the [[Arch_Panel|Arch Panel]] button. However, their base shape wouldn't be parametric. We now have several options: We could turn each component into a sketch, using the [[Draft_Draft2Sketch|Draft Draft2Sketch]] tool, but these will be rather heavy sketches, and might not be very manageable on a slow machine, or we could turn each individual wire (the outline and each hole) of the sketch into a separate sketch. This would allow us, for example, to reuse a typical hole, make it only once, then duplicate it with [[Draft_Clone|Draft Clone]] to make the other holes. This way, you would only need to edit one to edit them all.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
The [[Macro_Extract_Wires_from_Mesh|Macro Extract Wires from Mesh]] also sometimes fails in finding closed wires inside a mesh, which will not produce correct Panels. An easy procedure to recompose the wires of a component is this:
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
# Select the component, optionally hide everything else to see better
# [[Draft_Downgrade|Draft Downgrade]] it. It will be exploded into a series of individual edges
# Start selecting the holes with Ctrl or by using Shift + B to box-select
# Press [[Draft_Upgrade|Draft Upgrade]] to turn back each hole into an individual wire
# Finally select all the remaining individual edges in the tree, which form the outline, and [[Draft_Upgrade|Draft Upgrade]] them
# Select '''Part → make Compound''' to join back all these wires into one object
# Select the compound and press the [[Arch_Panel|Arch Panel]] button
</div>

[[Image:Arch_Wikihouse_11.jpg]]

<div lang="en" dir="ltr" class="mw-content-ltr">
There are many possible strategies here, depending on how editable and precise you need the result. The [[Arch_Panel|Arch Panel]] object needs a base object made of wires. It doesn't matter how this object is made, if it is a single sketch, or, like in the example above, a compound of different sketches or Draft object.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
== Converting to Sketches ==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
It is also possible to do that part later, you could already create Panels from each of the component, but let's see already how to to convert a wire-like object to a sketch:
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
# Create a copy of your wire-like object with {{Button|Ctrl}}+{{Button|C}}, {{Button|Ctrl}}+{{Button|V}}. This is so we can modify it but still keep one in its correct location
# Move and rotate it so it lies in the XY plane, using [[Draft_Move|Draft Move]] and [[Draft_Rotate|Draft Rotate]]. This is not indispensable, but the next point sometimes fails otherwise
# Use [[Draft Draft2Sketch]] to turn the wire into a sketch. Be warned, this can fail or take a very long time for huge wires. It is best to decompose your object into individual wires as shown above.
# If the command above fails, using [[Draft_Upgrade|Draft Upgrade]] twice on a wire-like object, to convert it to a Face then to a [[Draft_Wire|Draft Wire]], before using [[Draft_Draft2Sketch|Draft Draft2Sketch]], usually works better, because the Draft Wire keeps a better track of the order of vertices inside a wire.
# Curves are made of several small segments. They can be left as is, but they introduce a lot of endpoint constraints. It is better to replace them by arcs. It is fairly easy to do, just delete the small segments and replace them by an arc. The arc can then be made tangential to the neighbouring segments, but make sure the position of those segments is locked before doing this, as this operation will make them move.
# If you worked with several sketches, make a [[Part_Compound|Part Compound]] of them
# Create an [[Arch_Panel|Arch Panel]] from it
# Rotate/move it back into position with [[Draft_Move|Draft Move]] and [[Draft_Rotate|Draft Rotate]]
</div>

[[Image:Arch_Wikihouse_12.jpg]]

<div lang="en" dir="ltr" class="mw-content-ltr">
== Rebuilding the Wikihouse and exporting cut sheets ==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
Also, make sure you don't redo any duplicated part. Instead, select the [[Draft_Clone|Draft Clone]] tool to duplicate parts based on the same profile, so they will all share one same profile object. Then, since we have the outline at the correct place to use as a guide, it is fairly easy to rotate and move the clone into its correct position with [[Draft_Rotate|Draft Rotate]] and [[Draft_Move|Draft Move]].
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
After a while, all our Microhouse section is done.
</div>

[[Image:Arch_Wikihouse_01.jpg]]

<div lang="en" dir="ltr" class="mw-content-ltr">
We can now easily create the cut sheets, which are DXF files that will be sent to the shop that will cut the actual panels. The easiest way to do this is to select everything in your document with {{Button|Ctrl}}+{{Button|A}}, and then use the [[Arch_Panel_Cut|Arch Panel Cut]] tool. This will produce one Panel Cut object for each Panel object found in the selection. By moving them apart, we get a clear view of all our pieces:
</div>

[[Image:Arch_Wikihouse_02.jpg]]

<div lang="en" dir="ltr" class="mw-content-ltr">
We must then "nest" our pieces, that is, move and rotate them so they occupy as much as possible to space of a given panel, to generate as little material loss as possible. This operation unfortunately needs to be done by hand, but if you are using a Wikihouse project that already has produced cut sheets, copying them goes pretty fast:
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
# To make sure everything will stay in the XY plane, it is advised to set the [[Draft_SelectPlane|Working Plane]] to XY (top)
# Create an [[Arch_Panel_Sheet|Arch Panel Sheet]]
# Give it the desired width and height values (Wikihouses are typically printed on 122x244cm plywood sheets)
# Move it to a convenient place with [[Draft_Move|Draft Move]]
# Optionally, set its margin values to help you position the cut pieces
# Move and rotate the individual [[Arch_Panel_Cut|Arch Panel Cut]] objects so they fit inside the Panel Sheet
# When you are more or less ready, select the Panel Sheet, and double click it in the [[Tree_view|tree view]] to enter Edit mode
# Select all the Panel Cuts you wish to insert in it (you may want to switch the tree view to the "project" tab to select in the tree)
# Select the "group" section in the Panel Sheet's Task view
# Press the {{Button|Add}} button
# Press the {{Button|OK}} button
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
In the Panel Sheet's Task view, there is also a button that allows you to move the individual Panel Cuts after they've been inserted inside the sheet. After a while, we have our sheets ready:
</div>

[[Image:Arch_Wikihouse_03.jpg]]

<div lang="en" dir="ltr" class="mw-content-ltr">
The last step is simply to select all the sheets, then export them to DXF from menu File → Export. The sheets contents will be exported separated in different layers, with the same color coding commonly used by the Wikihouse project:
</div>

[[Image:Arch_Wikihouse_04.jpg]]

<div lang="en" dir="ltr" class="mw-content-ltr">
These files are ready to send to the shops that will do the actual cut. It would be possible to generate the G-Code to be sent to the CNC machine directly from FreeCAD too, but that is matter for another tutorial.
</div>