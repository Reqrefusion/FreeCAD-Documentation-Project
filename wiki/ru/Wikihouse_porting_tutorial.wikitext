<languages/>

{{TutorialInfo/ru
|Topic=Руководство по портированию файлов проекта Wikihouse в FreeCAD
|Level=Intermediate/Advanced
|Time=60 минут
|Author=
|FCVersion=
|Files=
}}

<span id="Introduction"></span>
== Вступление ==

В данном руководстве показано, как конвертировать [https://sketchup.com SketchUp] файлы, используемые в проекте [https://wikihouse.cc Wikihouse] в FreeCAD, с помощью инструментов [[Arch_Panel/ru|Архитектурных панелей]]. В результате должна получится полная копия исходного файла SketchUp, за исключением того, что он станет полностью параметрическим. Уровень параметризации конечного файла зависит от количества затраченной на него работы, как описано ниже. Но вполне возможно делать всё шаг за шагом и довольно быстро перестроить файл Wikihouse, а более длительное преобразование базовых профилей в эскизы оставить на потом.

Этот учебник требует промежуточных знаний FreeCAD, то есть вы уже можете ориентироваться в различных верстаках и инструментах, умеете моделировать простые объекты и, прежде всего, хорошо владеете инструментами [[Draft_Move/ru|Набросок Переместить]] и [[Draft_Rotate/ru|Набросок Повернуть]]. В основном будут использоваться инструменты Верстаков [[Draft_Workbench/ru|Набросок (Draft)]] и [[Arch_Workbench/ru|Архитектура (Arch)]], но знание [[Sketcher_Workbench/ru|Верстака Скетчер (Sketcher)]] станет необходимым при преобразовании базовых профилей в эскизы.

Поскольку проект Wikihouse является открытым по своей природе, файлы легко найти на сайте проекта, а также на [https://3dwarehouse.sketchup.com/search.html?q=wikihouse&backendClass=both SketchUp 3D Warehouse] или в репозиториях проекта [https://github.com/wikihouseproject github]. Предпочтительным форматом, используемым проектом, является Sketchup, поэтому большинство файлов, которые вы найдёте, будут в этом формате.

В следующем руководстве мы использовали файл [https://github.com/wikihouseproject/Microhouse/blob/master/microhouse_0.5_chassis.skp Chassis] из подпроекта Wikihouse's Microhouse (Вики-домик Микро-дом).

<span id="Preparing_the_Sketchup_file"></span>
== Подготовка файла Sketchup ==

Первое, что нужно сделать, это открыть файл в SketchUp и удалить все, что вы не хотите экспортировать. Мы будем экспортировать только одну часть Микро-дома, поэтому все остальное должно быть удалено.

[[Image:Arch_Wikihouse_05.jpg]]

Элементы Вики-домики в SketchUp создаются особым образом: Складывая небольшие "кусочки" вместе, вы создаёте различные компоненты:

[[Image:Arch_Wikihouse_06.jpg]]

Во FreeCAD мы будем действовать иначе. Поскольку одной из самых мощных возможностей FreeCAD является [[Sketcher_Workbench/ru|Ограниченные Эскизы]], нам лучше воспользоваться этим преимуществом и построить все элементы нашего Вики-домика на основе Эскизов. Таким образом, изменение любой детали можно будет производить в [[Sketcher_Workbench/ru|Верстаке Скетчер]], что гораздо удобнее.

Чтобы превратить наши объекты SketchUp в эскизы FreeCAD, которые затем можно использовать для создания объектов [[Arch_Panel/ru|Архитектурных Панелей]], нам нужно извлечь одну плоскую грань из каждой детали Вики-домика. Толщина будет добавлена позже, в FreeCAD, непосредственно в свойствах Архитектурной Панели. Таким образом, мы сохраним параметричность. Чтобы превратить каждый компонент Вики-домика в одну плоскую грань, войдите в каждый компонент, дважды щёлкнув по нему, затем выделите каждый подкомпонент и нажмите правую кнопку мыши → Разрушить (Explode), пока все подкомпоненты не будут разрушены, и ваш компонент будет состоять только из граней и рёбер:

[[Image:Arch_Wikihouse_08.jpg]]

После этого выделите все элементы компонента и снимите выделение, дважды щёлкнув Shift + двойной щелчок, с каждой фронтальной грани компонента. Обязательно дважды, а не один раз, потому что в противном случае вы снимите выделение только с лицевой стороны, но не с её граней (которые нам тоже нужно будет сохранить). После этого мы выделим всё, что хотим сохранить, поэтому нам останется только нажать клавишу delete. Теперь наш компонент - это всего лишь одна большая плоская грань.

[[Image:Arch_Wikihouse_07.jpg]]

Повторите это для каждого компонента. Поскольку многие из них дублируются, это не такая большая задача, как кажется. Кроме того, если вы не знакомы с системой Вики-домик, этот шаг даст вам довольно хорошее понимание того, как она работает.

Когда наш дом полностью состоит из плоских элементов, мы можем выделить все и экспортировать в файл .dae, а затем импортировать этот файл в FreeCAD. Не забудьте отметить опцию "triangulate all - триангулировать всё".

<span id="Solving_the_double_faces_bug"></span>
== Решение проблемы дублирования граней ==

Есть одна неприятная проблема, для которой я не нашёл лучшего решения: У сетки, экспортированной из SketchUp в формат .dae, дублируются грани. Каждая грань становится фактически двумя гранями. Самый простой способ, который я нашёл на данный момент, - открыть экспортированный файл в [https://blender.org Blender] для исправления:

# Откройте файл dae в Blender ({{MenuCommand|Файл → Импорт → Collada (Коллада)}})
# Выберите компонент и нажмите {{Button|TAB}}, чтобы войти в режим редактирования.
# Нажмите {{Button|A}}, чтобы отменить выделение всего, затем {{Button|A}} снова, чтобы выделить всё.
# Нажмите {{Button|W}} → Удалить дубликаты
# Нажмите {{Button|TAB}}, чтобы выйти из режима редактирования.
# Повторите для всех компонентов
# Сохраните новый файл [[Arch DAE/ru|DAE]] ({{MenuCommand|Файл → Экспорт → Collada/Коллада}})

Обычно вышеописанная операция не изменяет масштаб, но всегда стоит проверить, используя измерительные инструменты, что импортированная геометрия имеет правильный масштаб, прежде чем продолжать. При необходимости вам может потребоваться изменить настройки экспорта Collada/Коллада в Blender.

<span id="Importing_and_converting_to_wires"></span>
== Импорт и преобразование в ломанные кривые ==

Обратите внимание, что может быть проще работать по частям и обрабатывать + экспортировать объекты по группам, как мы сделали ниже, мы экспортировали только первый слой, состоящий из жёлтых элементов в SketchUp. Эти элементы попадут в FreeCAD как объекты [[Mesh_Workbench/ru|Сетки (Mesh)]]:

[[Image:Arch_Wikihouse_09.jpg]]

Следующим шагом будет создание ломанных кривых из каждой нашей сетки. Существует удобный макрос [[Macro_Extract_Wires_from_Mesh/ru|Макрос Извлечение Ломанных из сетки (Extract Wires from Mesh)]], который делает именно это. Установите его (инструкции см. на странице [[Macros/ru|Макросы]]), а затем по очереди (можно и все сразу, но этот макрос требует некоторого времени) преобразуйте все наши сетки в объекты ломанных кривых:

[[Image:Arch_Wikihouse_10.jpg]]

Теперь мы уже можем создавать объекты [[Arch_Panel/ru|Архитектурной Панели (Arch Panel)]] из каждого из этих криволинейных ломанных объектов, просто выделяя их и нажимая кнопку [[Arch_Panel/ru|Архитектурной Панели (Arch Panel)]]. Однако их базовая форма не будет параметрической. Теперь у нас есть несколько вариантов: Мы можем превратить каждый компонент в эскиз, используя инструмент [[Draft_Draft2Sketch/ru|Набросок НабросокВЭскиз (Draft Draft2Sketch)]], но это будут довольно тяжёлые эскизы, и они могут быть не очень удобны для медленного компьютера, или мы можем превратить каждую отдельную ломанную (контур и каждое отверстие) эскиза в отдельный эскиз. Это позволит нам, например, повторно использовать типовое отверстие, сделав его только один раз, а затем продублировать его с помощью [[Draft_Clone/ru|Набросок Клонировать (Draft Clone)]], чтобы сделать другие отверстия. Таким образом, для редактирования всех остальных отверстий достаточно отредактировать одно.

[[Macro_Extract_Wires_from_Mesh/ru|Макрос Извлечение Ломанных из сетки]] также иногда не может найти замкнутые контуры внутри сетки, что приводит к созданию неправильных Панелей. Простая процедура перекомпоновки ломанных в компоненте следующая:

# Выбери компонент, по желанию скрой всё остальное, чтобы лучше его рассмотреть
# Сделай [[Draft_Downgrade/ru|Драфт Даунгрейд (Draft Downgrade)]] его. Он будет разрушен на ряд отдельных рёбер
# Начни выделять отверстия с помощью Ctrl или с помощью Shift + B для выделения рамкой
# Нажми [[Draft_Upgrade/ru|Драфт Апгрейд (Draft Upgrade)]], чтобы превратить каждое отверстие в отдельную ломанную
# Наконец, выдели все оставшиеся отдельные рёбра в дереве, которые образуют контур, и сделай их [[Draft_Upgrade/ru|Драфт Апгрейд (Draft Upgrade)]]
# Выбери ''' Деталь (Part) → Создать соединение (Make Compound)''', чтобы объединить все эти кривые в один объект
# Выбери полученное соединение и нажми кнопку [[Arch_Panel/ru|Архитектурная Панель (Arch Panel)]]

[[Image:Arch_Wikihouse_11.jpg]]

Здесь существует множество возможных стратегий, в зависимости от того, насколько редактируемым и точным вам нужен результат. Объект [[Arch_Panel/ru|Архитектура Панель (Arch Panel)]] нуждается в базовом объекте из ломанных кривых. Неважно, как будет создан этот объект, будет ли это один Эскиз (Sketch), или, как в примере выше, Соединение (Compound) различных эскизов или объект Наброска (Draft).

<span id="Converting_to_Sketches"></span>
== Преобразование в Эскизы ==

Эту операцию можно сделать и позже, ведь уже сейчас можно создать панели из каждого компонента, но давайте посмотрим, как преобразовать криволинейный ломанный объект в эскиз:

# Создай копию объекта, похожего на ломанную кривую, с помощью {{Button|Ctrl}}+{{Button|C}}, {{Button|Ctrl}}+{{Button|V}}. Это нужно для того, чтобы мы могли изменять его, но при этом сохранить в правильном месте
# Перемести и поверни его так, чтобы он лежал в плоскости XY, используя [[Draft_Move/ru|Набросок Переместить (Draft Move)]] и [[Draft_Rotate/ru|Набросок Повернуть (Draft Rotate)]]. Это не является обязательным, но в противном случае иногда не удаётся выполнить следующий пункт
# Используй [[Draft_Draft2Sketch/ru|Набросок НабросокВЭскиз (Draft Draft2Sketch)]], чтобы превратить ломанную в эскиз. Будь внимателен, это может не сработать или занять очень много времени для огромных ломанных кривых. Лучше всего разбить объект на отдельные ломанные, как показано выше
# Если команда выше не сработала, используй [[Draft_Upgrade/ru|Набросок Апгрейд (Draft Upgrade)]] дважды на криволинейном ломанном объекте, чтобы преобразовать его в Грань (Face), а затем в [[Draft_Wire/ru|Набросок Ломанную (Draft Wire)]], прежде чем использовать [[Draft_Draft2Sketch|Набросок НабросокВЭскиз (Draft Draft2Sketch)]], обычно это работает лучше, потому что Набросок Ломанная (Draft Wire) лучше отслеживает порядок вершин внутри кривой ломанной
# Кривые состоят из нескольких небольших сегментов. Их можно оставить как есть, но они вводят много ограничений на конечные точки. Лучше заменить их дугами. Это довольно легко сделать: просто удалив маленькие сегменты и заменив их дугой. Затем дугу можно сделать касательной к соседним сегментам, но перед этим убедись, что положение этих сегментов зафиксировано, так как эта операция заставит их перемещаться
# Если ты работал с несколькими эскизами, создай из них [[Part_Compound/ru|Деталь Соединение (Part Compound)]].
# Создай из них [[Arch_Panel/ru|Архитектурную Панель (Arch Panel)]].
# Поверни/перемести её в нужное место с помощью [[Draft_Move/ru|Набросок Переместить (Draft Move)]] и [[Draft_Rotate/ru|Набросок Повернуть (Draft Rotate)]].

[[Image:Arch_Wikihouse_12.jpg]]

<span id="Rebuilding_the_Wikihouse_and_exporting_cut_sheets"></span>
== Перестройка Вики-домика и экспорт листов для раскроя (резки) ==

Также убедись, что ты не переделываешь дублированную часть. Вместо этого выбери инструмент [[Draft_Clone/ru|Набросок Клонировать (Draft Clone)]], чтобы продублировать детали на основе одного и того же профиля, так что все они будут иметь один и тот же объект профиля. Затем, поскольку у нас есть контур в нужном месте, чтобы использовать его в качестве направляющей, довольно легко повернуть и переместить клон в нужное положение с помощью [[Draft_Rotate/ru|Набросок Повернуть (Draft Rotate)]] и [[Draft_Move/ru|Набросок Переместить (Draft Move)]].

Через некоторое время вся наша секция Микродома будет закончена.

[[Image:Arch_Wikihouse_01.jpg]]

Теперь мы можем легко создать листы раскроя - DXF-файлы, которые будут отправлены в мастерскую для раскроя панелей. Самый простой способ сделать это - выделить всё в документе с помощью {{Button|Ctrl}}+{{Button|A}}, а затем использовать инструмент [[Arch_Panel_Cut/ru|Архитектура Вырезать Панель (Arch Panel Cut)]]. В результате будет создан один объект Вырезать Панель (Panel Cut) для каждого объекта Панель (Panel), находящегося в выделении. Раздвинув их, мы получим чёткое представление обо всех наших деталях:

[[Image:Arch_Wikihouse_02.jpg]]

Затем мы должны "разместить" наши фрагменты, то есть переместить и повернуть их так, чтобы они размещались как можно плотнее на заданной панели, чтобы потери материала были как можно меньше. Эту операцию, к сожалению, приходится выполнять вручную, но если вы используете проект Wikihouse, в котором уже есть готовые раскроенные листы, их копирование происходит довольно быстро:

# Чтобы убедиться, что всё будет оставаться в плоскости XY, рекомендуется установить [[Draft_SelectPlane/ru|Рабочую Плоскость]] на XY (верх).
# Создай [[Arch_Panel_Sheet/ru|Архитектура Лист Панели (Arch Panel Sheet)]]
# Задай ему желаемые значения ширины и высоты (обычно Вики-домик печатают на листах фанеры размером 122x244 см)
# Перемести её в удобное место с помощью [[Draft_Move/ru|Набросок Переместить (Draft Move)]].
# По желанию установи значения полей, чтобы помочь расположить вырезанные фрагменты.
# Перемести и поверни отдельные объекты [[Arch_Panel_Cut/ru|Архитектура Вырезать Панель (Arch Panel Cut)]] так, чтобы они поместились внутри Листа Панели (Panel Sheet)
# Когда всё будет более-менее готово, выбери Лист Панели (Panel Sheet) и дважды щёлкни по нему в [[Tree_view/ru|дереве проекта]], чтобы перейти в режим редактирования.
# Выбери все Вырезы Панели (Panel Cuts), которые ты хочешь вставить в этот Лист (возможно, тебе понадобится переключить дерево проекта на вкладку "проект - project", чтобы выбирать из дерева проекта)
# Выбери раздел "группа - group" на вкладке Панель задач у нашего Листа Панели (Panel Sheet).
# Нажми кнопку {{Button|Add - Добавить}}
# Нажми кнопку {{Button|OK}}

В панели задач Листа (Panel Sheet's) также есть кнопка, позволяющая перемещать отдельные Вырезы Панели (Panel Cuts) после того, как они были вставлены в лист. Через некоторое время наши листы готовы:

[[Image:Arch_Wikihouse_03.jpg]]

Последний шаг - просто выдели все листы, а затем экспортируй их в формат DXF из меню Файл → Экспорт. Содержимое листов будет экспортировано разделённым на разные слои, с той же цветовой кодировкой, которая обычно используется в проекте Вики-домика:

[[Image:Arch_Wikihouse_04.jpg]]

Эти файлы готовы к отправке в мастерские, которые будут выполнять фактическую резку. Можно также сгенерировать G-код для отправки на станок с ЧПУ непосредственно из FreeCAD, но это уже вопрос для другого учебного руководства.