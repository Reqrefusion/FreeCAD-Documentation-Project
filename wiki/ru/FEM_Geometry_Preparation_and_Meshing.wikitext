<languages/>

{{TutorialInfo
|Topic=Метод конечных элементов
|Level=Начальный
|Time=Н/Д
|Author=[[https://www.freecad.org/wiki/index.php?title=User](https://www.freecad.org/wiki/index.php?title=User):NewJoker NewJoker]
|FCVersion=1.0 или выше
|SeeAlso=[[FEM_Workbench|Рабочая среда FEM]]
}}

<span id="Background"></span>
== Общие сведения ==

Подготовка геометрии и создание сетки являются ключевыми этапами предварительной обработки для симуляций с использованием метода конечных элементов (МКЭ). Хотя доступное программное обеспечение для симуляций, интегрированное с CAD-средой (например, [[FEM_Workbench|Модуль МКЭ]] в FreeCAD), делает заманчивым немедленное выполнение анализов новых конструкций, важно помнить, что МКЭ — это сложный метод, требующий правильно подготовленной геометрии и сетки для получения достоверных и точных результатов. Здесь особенно применимо правило «мусор на входе — мусор на выходе». Существуют и другие важные настройки, от которых сильно зависит точность МКЭ (например, свойства материалов и граничные условия), но первыми шагами и одними из наиболее частых источников проблем являются подготовка геометрии и создание сетки, которые обсуждаются на этой странице.

<span id="Types_of_geometry_used_for_FEM_in_FreeCAD"></span>
== Типы геометрии, используемые для МКЭ в FreeCAD ==

* Линии (каркасы) — используются для анализов с балочными элементами
* Поверхности — используются для анализов с оболочечными и 2D-элементами (плоское напряжение/деформация и осесимметричные элементы)
* Тела — используются для анализов с объемными элементами

<span id="Choice_of_the_type_of_geometry"></span>
== Выбор типа геометрии ==

Хотя большинство конструкций состоят из тел, часто настоятельно рекомендуется использовать линии или поверхности для МКЭ, если структура это позволяет:
* Если деталь является тонкой (длинной и узкой) и похожа на балку с регулярным поперечным сечением одного из поддерживаемых типов сечений балок (прямоугольное, круглое или трубчатое), то её следует анализировать с использованием балочных элементов (за исключением случаев, когда специфические виды нагрузки, реакции или неизбежные геометрические детали делают это предположение недействительным). В основном, необходимо нарисовать центральную линию (некоторые советы по её извлечению из существующей геометрии тела можно найти в [https://forum.freecad.org/viewtopic.php?t=81589 этой теме форума] — вкратце, используйте [[Draft_Wire|Draft Wire]] или [[Draft_BSpline|Draft BSpline]] с соответствующими [[Draft_Workbench#Draft_snap_toolbar|привязками]] и [[Draft_Line|линиями]] в качестве опор) и применить [[FEM_ElementGeometry1D|сечение балки]] с опциональным [[FEM_ElementRotation1D|поворотом]]. Не существует единого правила, определяющего, когда можно использовать балочные элементы, но часто рекомендуется, чтобы размеры поперечного сечения составляли менее 1/10 длины детали, чтобы предположение о балке считалось действительным.

[[Image:FEM_beam_model.JPG|600px]]
{{Caption|Тонкая деталь, подходящая для анализа с балочными элементами — выделена центральная линия}}

* Если деталь имеет тонкие стенки (например, детали из листового металла), её следует анализировать с использованием оболочечных элементов (за исключением случаев, когда требуются точные результаты контакта или сталкиваются с ограничениями оболочечных элементов). Это очень важно и часто упускается из виду. Для достижения должной точности результатов (особенно при изгибе) необходимо использовать несколько элементов (не менее 3–5) в направлении толщины. В случае деталей с тонкими стенками это обычно приводит к созданию больших сеток (особенно при использовании тетраэдров, поскольку гексаэдральные элементы не могут быть сгенерированы в FreeCAD) и высокой вычислительной стоимости — высокие требования к вычислительной мощности и длительное время решения. Чтобы получить геометрию, подходящую для анализа с оболочечными элементами, следует нарисовать срединную поверхность детали (некоторые советы по её извлечению из существующей геометрии тела можно найти в [https://forum.freecad.org/viewtopic.php?t=67505 этой теме форума], [https://forum.freecad.org/viewtopic.php?t=71821 этой] и [https://forum.freecad.org/viewtopic.php?t=81834 этой] — вкратце, примените [[PartDesign_SubShapeBinder|PartDesign SubShapeBinder]] или [[Draft_Facebinder|Draft Facebinder]], затем [[Part_Offset|Part Offset]] и, наконец, используйте SubShapeBinder и [[Part_Extrude|Extrude]] для расширения краёв срединных поверхностей, чтобы закрыть зазоры между ними) и применить соответствующую [[FEM_ElementGeometry2D|толщину]]. Опять же, нет единого правила, но обычно рекомендуется, чтобы толщина составляла менее 1/10 от типичного глобального размера (длины/ширины), чтобы предположение об оболочке считалось действительным.

[[Image:FEM_shell_model.JPG|600px]]
{{Caption|Деталь с тонкими стенками, подходящая для анализа с оболочечными элементами — выделена срединная поверхность}}

* В некоторых случаях также возможны 2D-анализы, которые можно включить, установив свойство {{PropertyData|Model Space}} решателя [[FEM_SolverCalculixCcxtools|CalculiX]]:
** Плоское напряжение — для тонких деталей, которые можно упростить до плоских поверхностей, представляющих профиль для выдавливания (толщина задаётся так же, как для оболочек), которые нагружаются и деформируются только в плоскости и имеют нулевое напряжение в направлении, перпендикулярном плоскости. Доступны только две степени свободы — перемещения по X и Y. Поверхности в этом случае должны лежать в плоскости XY. Этот подход довольно распространён. Например, тонкая пластина, подверженная растяжению, может быть проанализирована таким образом.
** Плоская деформация — для толстых деталей, которые можно упростить до плоских поверхностей, представляющих профиль для выдавливания (толщина задаётся так же, как для оболочек), которые нагружаются и деформируются только в плоскости и имеют нулевую деформацию в направлениях, перпендикулярных плоскости. Доступны только две степени свободы — перемещения по X и Y. Поверхности в этом случае должны лежать в плоскости XY. Этот подход менее распространён. Например, длинная плотина, стена или труба, подверженная равномерному давлению по всей длине, может быть проанализирована таким образом.
** Осесимметричный — для деталей, которые можно упростить до плоских поверхностей, представляющих профиль вращения (толщина здесь не имеет значения), и которые нагружаются равномерно по всей окружности. Доступны только две степени свободы — радиальное и осевое перемещение. Поверхности должны лежать в плоскости XY, справа от оси Y. Этот подход очень распространён. Например, некоторые сосуды под давлением, резиновые опоры, втулки, прокладки, фланцы и даже болтовые соединения (с учётом резьбы как осесимметричной) могут быть проанализированы таким образом.

Следует помнить, что балочные, оболочечные, плосконапряжённые/плоскодеформированные и осесимметричные элементы, используемые в CalculiX, не являются настоящими элементами такого типа (они не используют классические формулировки элементов, известные из литературы и других программ). Внутренне они преобразуются в объёмные элементы. Тем не менее, их использование рекомендуется в вышеупомянутых случаях.

<span id="Geometry_validity"></span>
== Корректность геометрии ==

Геометрия, используемая для МКЭ, должна быть корректной. В первую очередь, в ней не должно быть пересечений. Это распространённая проблема, которая часто возникает, когда сборки моделируются без надлежащих ограничений между деталями. Инструмент [[Part_SectionCut|Part SectionCut]] может помочь выявить такие пересечения между деталями. Конечно, [[Part_Fuse|Part Fuse]] может помочь устранить их, если они созданы намеренно. Другие проблемы с геометрией (такие как неразвёртываемые геометрии, избыточные рёбра или грани и т. д.) также должны быть исправлены перед переходом к созданию сетки. Инструмент [[Part_CheckGeometry|Part CheckGeometry]] может быть полезен, но визуальная проверка также важна. При подготовке симуляции с использованием объёмных элементов, если есть сомнения, является ли деталь действительно твёрдым телом или просто замкнутой оболочкой, упомянутые инструменты (Part SectionCut и вкладка ''Shape Content'' в результатах инструмента Part CheckGeometry) могут это прояснить.

<span id="Surface_normals"></span>
== Нормали поверхностей ==

В случае поверхностной геометрии, используемой для анализов с оболочечными и 2D-элементами, направление нормалей поверхностей может быть важным. Они используются для определения положительной и отрицательной стороны сетки конечных элементов поверхности и влияют на такие аспекты анализа, как нагрузки от давления и контакт. Кроме того, 2D-анализы (плоское напряжение/деформация и осесимметричные) в CalculiX требуют, чтобы нормали были направлены в положительном направлении оси Z. Если они инвертированы, возникнут ошибки отрицательного якобиана.

Для проверки нормалей используйте один из следующих подходов:
* включите подсветку в [[Preferences_Editor|Настройках]] и установите свойство {{PropertyView|Lighting}} объекта поверхности в значение «Одна сторона» — направление отрицательной нормали будет выглядеть темнее,
* используйте макрос [[Macro_Normal_Vector|Normal Vector]],
* создайте сетку для поверхностной формы в модуле МКЭ — сетка будет окрашена только на стороне положительной нормали.

Для инвертирования нормалей используйте инструмент [[Part_ReverseShape|Инвертировать формы]].

<span id="Using_surface_meshes_for_FEM"></span>
== Использование поверхностных сеток для МКЭ ==

Поверхностные сетки [[Mesh_MeshObject|MeshObject]], обычно импортируемые из файлов STL, OBJ и подобных или созданные в [[Mesh_Workbench|Модуле работы с сетками]], не могут использоваться напрямую для МКЭ. Сначала необходимо [[Part_ShapeFromMesh|создать форму из сетки]]. Затем эта форма может быть разбита на сетку в модуле МКЭ для создания поверхностной (оболочечной / 2D) сетки конечных элементов. Если требуется объёмная (3D) сетка конечных элементов, после создания формы необходимо выполнить [[Part_MakeSolid|преобразование в твёрдое тело]].

Самая большая проблема с формами, созданными из поверхностных сеток, заключается в том, что все их треугольники становятся гранями полученной формы. В МКЭ это делает назначение характеристик анализа (таких как нагрузки и граничные условия) особенно проблематичным. В случае плоских поверхностей [[Part_RefineShape|очистка]] после преобразования в твёрдое тело может удалить избыточные треугольные грани. Однако в практических сценариях большинство из них всё же останутся, и поэтому использование поверхностных сеток для МКЭ не рекомендуется. Вместо этого следует использовать CAD-геометрии (созданные в FreeCAD или импортированные из файлов STEP/IGES). Иногда даже может иметь смысл воссоздать геометрию на основе поверхностной сетки.

<span id="Geometry_simplification"></span>
== Упрощение геометрии ==

<span id="Defeaturing"></span>
=== Удаление мелких деталей ===

Конструкции, подготовленные в CAD-программах, обычно слишком детализированы для использования в симуляциях МКЭ. Во многих случаях их необходимо сначала упростить. Этот шаг часто упускается из виду, но он очень важен, поскольку получение качественной сетки может быть затруднительным, если деталь слишком сложная, и даже если такая сетка в итоге будет создана, она может быть очень плотной, что приведёт к неоправданно долгому времени решения. Поэтому всегда следует анализировать конструкцию и стараться максимально её упростить, оставляя только те геометрические особенности, которые могут существенно влиять на результаты (прочность/жёсткость) и, следовательно, не могут быть проигнорированы. Обычно исключаются следующие элементы:
* мелкие скругления и фаски,
* небольшие отверстия,
* другие мелкие детали,
* сварные швы,
* болты, резьбы,
* декоративные элементы (логотипы, гравировки).

Инструмент [[Part_Defeaturing|Удаление мелких деталей]] и дополнение [[Defeaturing_Workbench|Модуль упрощения геометрии]] могут быть полезны при упрощении деталей для симуляций.

[[Image:FEM_bracket_original.PNG|400px]]
{{Caption|Исходная геометрия кронштейна}}

[[Image:FEM_bracket_simplified.PNG|400px]]
{{Caption|Геометрия кронштейна, упрощённая с использованием только инструмента удаления мелких деталей}}

<span id="Replacing_parts_with_boundary_conditions"></span>
=== Замена деталей граничными условиями ===

В случае сборок (подробнее о них в одном из следующих разделов) некоторые детали часто можно исключить из симуляций и заменить граничными условиями, если они были прикреплены к анализируемым деталям. Такой подход оправдан, если исключённые детали значительно жёстче (с точки зрения конструктивной жёсткости, учитывающей не только упругость материала, но и геометрию детали), чем анализируемые детали, к которым они были присоединены. Это связано с тем, что фиксированные граничные условия обеспечивают жёсткость (как если бы анализируемая деталь была прикреплена к бесконечно жёсткому компоненту), а гибкие опоры, такие как пружинные элементы, недоступны в модуле МКЭ FreeCAD при использовании CalculiX (в Elmer есть [[FEM_ConstraintSpring|Ограничение пружины]]).

<span id="Utilizing_planar_symmetry"></span>
=== Использование плоскостной симметрии ===

Упрощение геометрии для МКЭ также может включать разрезание её по одной из плоскостей симметрии для использования предположения о плоскостной симметрии в анализе. Это предположение справедливо только в том случае, если все следующие аспекты модели обладают симметрией в заданной плоскости:
* геометрия,
* нагрузки,
* граничные условия,
* реакция (нужно быть осторожным с частотными/анализами на потерю устойчивости при использовании симметрии — антисимметричные формы мод не будут получены).
Использование симметрии (1/2, 1/4 или 1/8 модели) рекомендуется, когда это возможно, поскольку это может значительно снизить вычислительные затраты на анализ. Другим преимуществом является устранение некоторых движений твёрдого тела, что упрощает закрепление детали. Условие симметрии должно быть применено к граням, принадлежащим плоскости разреза:
* перемещение в направлении, нормальном к плоскости симметрии, должно быть заблокировано для объёмных деталей,
* перемещение в направлении, нормальном к плоскости симметрии, и вращения, кроме как вокруг оси, нормальной к плоскости симметрии, должны быть заблокированы для оболочечных и балочных деталей.
Приложенная сила должна быть соответствующим образом уменьшена, если плоскость симметрии пересекает область, к которой приложена сила (не имеет значения при использовании нагрузки давлением).

[[Image:FEM_symmetric_vessel.JPG|400px]]
{{Caption|Модель 1/8 цилиндрического сосуда под давлением с граничными условиями симметрии и внутренней нагрузкой давлением}}

<span id="Utilizing_cyclic_symmetry"></span>
=== Использование циклической симметрии ===

Другой, менее распространённый тип симметрии, доступный в FreeCAD FEM, — это циклическая симметрия. Она может быть задана с помощью [[FEM_ConstraintTie#Cyclic_symmetry|ограничения связывания]] и позволяет анализировать только один представительный сектор структуры, состоящей из таких круговых узоров вокруг оси. Предполагается, что граничные условия и нагрузки также обладают этой формой симметрии. Могут быть приложены тангенциальные нагрузки, что позволяет моделировать кручение. Однако чаще всего с циклической симметрией используется [[FEM_ConstraintCentrif|центробежная нагрузка]]. Этот подход может применяться, например, для роторов, валов, турбин, вентиляторов и маховиков.

<span id="Geometry_partitioning"></span>
== Разбиение геометрии ==

<span id="Partitioning_basics"></span>
=== Основы разбиения ===

Так называемое разбиение представляет собой деление геометрии на более мелкие сегменты. В других программах оно обычно используется для создания гексаэдральной сетки, но в FreeCAD оно может быть полезно и по другим причинам:
* создание подобластей для назначения характеристик анализа,
* разделение деталей на секции из разных материалов,
* создание регионов для [[FEM_MeshRegion|уточнения сетки]],
* управление алгоритмом создания сетки путём принудительного следования дополнительным рёбрам (особенно полезно для контроля [[FEM_MeshGmshFromShape#Mesh_Growth|роста сетки Gmsh]]).

<span id="Partitioning_faces_of_solids_with_sketches"></span>
=== Разбиение граней твёрдых тел с помощью эскизов ===

Основное применение разбиения заключается в случаях, когда нагрузка (или граничное условие) должна быть приложена только к выбранной области поверхности детали. Самый простой способ добиться этого для твёрдых тел — создать эскиз с соответствующим контуром на этой грани и использовать инструмент [[Part_BooleanFragments|Булевы фрагменты]] для разделения грани с помощью эскиза.

[[Image:FEM_partition.JPG|400px]]
{{Caption|Деталь с разбиением грани для приложения нагрузки или граничного условия}}

<span id="Partitioning_volumes_of_solids_with_datum_planes"></span>
=== Разбиение объёмов твёрдых тел с помощью опорных плоскостей ===

Ещё одна причина для разбиения — необходимость применения нескольких материалов к одной детали (без использования нескольких деталей, соединённых друг с другом). В этом случае разбиение можно выполнить с помощью [[PartDesign_Plane|опорной плоскости]] и инструмента [[Part_BooleanFragments|Булевы фрагменты]] в режиме «Комбинированное тело».

<span id="Partitioning_surface_geometries_with_sketches"></span>
=== Разбиение поверхностных геометрий с помощью эскизов ===

В случае поверхностных (оболочечных) геометрий самый простой способ создания разбиения на основе эскиза — использовать инструмент [[Part_BooleanFragments|Булевы фрагменты]] (как для разбиения граней твёрдых тел). Однако, как объяснено [https://forum.freecad.org/viewtopic.php?t=96029#p820241 здесь], если в [[FEM_Preferences#General|настройках МКЭ]] включено создание групп сетки, это может работать некорректно, и следует использовать следующий подход:
1. Создайте грань для одной стороны, например, с помощью инструмента [[Part_MakeFace|Создать грань]] (например, квадратная пластина с круглым отверстием).
2. Создайте грань для другой стороны аналогичным образом (например, круглая грань, заполняющая отверстие в квадратной пластине).
3. Примените инструмент [[Part_Builder|Конструктор деталей]] в режиме «Оболочка из граней» с отключённой опцией «Очистить форму» к ранее созданным граням.

[[Image:FEM_shell_partition.JPG|400px]]
{{Caption|Квадратная пластина с разбиением на круглую грань}}

<span id="Partitioning_faces_of_solids_with_datum_planes"></span>
=== Разбиение граней твёрдых тел с помощью опорных плоскостей ===

Разбиение только выбранных граней твёрдого тела с использованием опорных плоскостей вместо эскизов без разделения всего объёма также является сложной задачей. Один из возможных подходов:
1. [[Draft_Downgrade|Разделите]] тело на грани.
2. Выберите эту грань и опорную плоскость и используйте инструмент [[Part_SliceApart|Разделить на части]].
3. Удалите контейнер Exploded Slice, не удаляя его содержимое.
4. Выберите все грани и срезы и [[Draft_Upgrade|Объедините]] их в оболочку.
5. [[Draft_Upgrade|Объедините]] оболочку в твёрдое тело или используйте инструмент [[Part_MakeSolid|Преобразовать в твёрдое тело]].
Другой способ:
1. Создайте [[PartDesign_SubShapeBinder|подобъект]] грани, которую нужно разбить.
2. Разделите подобъект с помощью опорной плоскости, используя инструмент [[Part_SliceApart|Разделить на части]].
3. Создайте новое [[PartDesign_Body|Тело]] (чтобы избежать циклической зависимости).
4. Создайте новый подобъект из рёбер, полученных от пересечения предыдущего подобъекта и опорной плоскости.
5. Выберите исходное тело и новый подобъект и используйте инструмент [[Part_BooleanFragments|Булевы фрагменты]].
Другие идеи можно найти в [https://forum.freecad.org/viewtopic.php?t=98528 этой теме форума], но они более специфичны для конкретных случаев.

[[Image:FEM_split_face_solid.JPG|400px]]
{{Caption|Цилиндрическая грань отверстия, разделённая плоскостью для приложения нагрузки на 180° от штифта}}

<span id="Assembly_geometries"></span>
== Геометрии сборок ==

Одним из текущих основных ограничений модуля МКЭ является отсутствие поддержки нескольких сеток. На практике это означает, что нельзя создать сетку для каждой детали сборки отдельно, а затем соединить их с помощью соответствующих ограничений для анализа. Вместо этого необходимо создать единый объект, содержащий все детали сборки, и разбить его на сетку. Здесь есть несколько различных вариантов, все они основаны на [[Part_Workbench#Boolean_toolbar|булевых инструментах модуля Part]]. Выбор зависит от желаемого результата — должны ли отдельные детали/объёмы и их границы быть доступными для выбора (например, для назначения материалов или определения граничных условий, действующих на внутренние грани) или нет:
* [[Part_Fuse|Part Fuse]] — объединяет детали, делая невозможным их индивидуальный выбор, например, для определения материалов,
* [[Part_Compound|Part Compound]] — создаёт составной объект, позволяя выбирать отдельные детали,
* [[Part_JoinConnect|Part JoinConnect]] — работает как Part Fuse, объединяет детали, делая невозможным их индивидуальный выбор,
* [[Part_BooleanFragments|Part BooleanFragments]] — работает как Part Compound, позволяя выбирать отдельные детали.
Важно отметить, что если детали точно соприкасаются, на булевом объекте будет создана непрерывная сетка, и для симуляции не потребуются дополнительные ограничения (за исключением случаев, когда используется Part Compound и узлы не совпадают, или свойство [[FEM_MeshGmshFromShape#Properties|«Coherence Mesh» Gmsh]] установлено в {{FALSE}}). Если между деталями есть даже небольшой зазор (или пересечение в случае Part Compound), сетка не будет непрерывной, и потребуются ограничения, такие как [[FEM_ConstraintTie|связывание]] или [[FEM_ConstraintContact|контакт]]. Проведение частотного анализа — хороший способ определить, является ли сетка непрерывной: если детали не соединены, первые формы мод с визуализированной деформацией с помощью [[FEM_PostFilterWarp|фильтра деформации]] покажут разделение — детали будут «разлетаться».

[[Image:FEM_modal_separation.JPG|400px]]
{{Caption|Первая форма моды частотного анализа, визуализированная с помощью фильтра деформации — анализировались два куба с небольшим начальным зазором}}

Часто рекомендуется использовать булевы фрагменты в режиме Compsolid, а затем применять к ним [[Part_CompoundFilter|Фильтр составных объектов]], особенно при анализе сборок из нескольких материалов и твёрдых тел, встроенных в другие твёрдые тела без вырезов (как в руководстве [[FEM_Shear_of_a_Composite_Block|Сдвиг композитного блока в МКЭ]]). Как видно на вкладке «Shape Content» инструмента [[Part_CheckGeometry|Проверка геометрии]] (важно использовать этот инструмент в случае сомнений в таких ситуациях), фильтр составных объектов удаляет составной объект и оставляет только Compsolid, состоящий из нескольких твёрдых тел, соединённых своими гранями.

Обходы ошибок, таких как:

{{Code|lang=text|code=
ERROR: femelement_table != count_femelements
Error in get_femelement_sets -- > femelements_count_ok() failed!
}}

и:

{{Code|lang=text|code=
*ERROR in calinput: no material was assigned
to element …
}}

включают:
* оставление последнего материала без привязки к какому-либо твёрдому телу (он будет автоматически назначен всем твёрдым телам, не указанным в других определениях материалов),
* использование Netgen вместо Gmsh для создания сетки,
* небольшое разделение деталей и применение ограничений связывания для их соединения в симуляции.

Такие ошибки вызваны отсутствием или перекрытием определений материалов в некоторых элементах. [https://forum.freecad.org/viewtopic.php?t=97120&start=50#p829295 Эта публикация на форуме] содержит ссылки, которые ясно это демонстрируют, и вся ветка обсуждения может быть полезна при возникновении подобных проблем.

<span id="Selection_of_interior_entities"></span>
=== Выбор внутренних элементов ===

Выбор внутренних регионов (например, граней/объёмов) может быть сложным. Это может потребоваться для применения различных материалов, объёмных нагрузок или граничных условий (особенно в тепловых и электромагнитных анализах). Возможны несколько способов:
* включение [[Std_ToggleClipPlane|отсекающей плоскости]] на время выбора и указание внутренних граней,
* скрытие булева объекта, отображение только одной из деталей, к которой он был применён, и выбор её,
* включение [[Std_ToggleTransparency|прозрачности]] и использование [[Selection_View|Представления выбора]] с включённой опцией «Список выбранных объектов», как описано [https://forum.freecad.org/viewtopic.php?t=96984#p826693 здесь],
* выбор другого внешнего объекта и редактирование свойства «References» на вкладке «Data» для данной характеристики анализа (требует ручного указания номера геометрического объекта).

<span id="Meshing_basics"></span>
== Основы создания сетки ==

<span id="Choosing_element_size"></span>
=== Выбор размера элемента ===

Слишком грубая сетка — одна из наиболее распространённых причин неточностей и других проблем в методе конечных элементов (FEM). Часто это связано с настройками автоматического генератора сетки — по умолчанию он создаёт слишком грубую, неподходящую сетку, если размер элемента не задан вручную и остаётся по умолчанию. Всегда следует знать примерные размеры детали, особенно размер наименьшего важного элемента (для его определения можно использовать инструмент [[Std_Measure|Std Measure]]), и задавать максимальный размер элемента на основе этих данных.Существует также параметр минимального размера элемента, который может предотвратить создание слишком мелких элементов вокруг малых геометрических особенностей. Такие мелкие элементы могут приводить к чрезмерно плотной сетке (а иногда даже к сбоям или зависаниям FreeCAD при попытке сгенерировать подобную сетку). В общем случае лучше начинать с более грубой сетки (её создание занимает меньше времени), посмотреть, как она выглядит (для этого требуется некоторый опыт), и при необходимости уточнить её. Часто имеет смысл использовать плотную сетку только в областях интереса (зонах с большими градиентами или концентрациями напряжений — например, в местах вырезов или надрезов) и относительно грубую сетку на удалении от них. Таким образом, количество элементов можно значительно сократить, что приведёт к уменьшению времени решения задачи. 
Локальное уточнение сетки определяется с помощью инструмента [[FEM_MeshRegion|FEM MeshRegion]].

[[Image:FEM_default_mesh.PNG|400px]]
{{Caption|Сетка по умолчанию, слишком грубая}}

[[Image:FEM_globally_refined_mesh.PNG|400px]]
{{Caption|Глобально уточнённая сетка}}

[[Image:FEM_locally_refined_mesh.PNG|400px]]
{{Caption|Локально уточнённая сетка}}

<span id="Choosing_element_type"></span>
=== Выбор типа элемента ===

Выбор типа элемента — задача непростая и зависит от множества факторов, однако общее правило заключается в том, что гексагональные и квадратные элементы предпочтительнее тетраэдрических и треугольных. Тем не менее, сложные геометрии невозможно разбить на сетку с гексагональными элементами, и FreeCAD не способен корректно их генерировать (только с использованием алгоритма Subdivision генератора сетки Gmsh, но результаты отличаются от ожидаемых для гексагональной сетки).

Квадратные или преимущественно квадратные сетки могут быть нормально сгенерированы на поверхностях — см. [[https://forum.freecad.org/viewtopic.php?t=20351](https://forum.freecad.org/viewtopic.php?t=20351) эту тему на форуме]. Гексагональные элементы можно импортировать из внешних генераторов сеток, таких как [[https://gmsh.info](https://gmsh.info) Gmsh], и использовать в рабочей среде FEM, как показано в [[https://www.youtube.com/watch?v=vylt24G7qj4&t=932s](https://www.youtube.com/watch?v=vylt24G7qj4&t=932s) этом видео].

<span id="Choosing_element_order"></span>
=== Выбор порядка элементов ===

Выбор порядка элементов (первого или второго) зависит от условий анализа, но в большинстве случаев предпочтение отдаётся элементам второго порядка. Это особенно важно для треугольных и тетраэдрических элементов — их элементы первого порядка (линейные) обычно не рекомендуются для регулярного использования и должны применяться только как заполняющие элементы в областях, не имеющих большого значения. Однако, поскольку FreeCAD не может корректно генерировать гексагональные элементы, в некоторых случаях можно использовать линейные тетраэдры, если сетка достаточно плотная. Особенно это актуально при выполнении анализов с [[FEM_ConstraintContact|контактами]].

<span id="Negative_Jacobians"></span>
== Отрицательные якобианы ==

Если соблюдать приведённые выше правила (особенно касающиеся корректности геометрии, упрощения модели и выбора размера элемента), сетка должна генерироваться корректно. Однако в некоторых случаях геометрию невозможно сильно упростить, или же сама процедура моделирования корректна, но всё равно приводит к появлению мелких рёбер и граней. В таких ситуациях генерация сетки с элементами второго порядка может завершиться неудачей из-за отрицательных якобианов.

Причина заключается в том, что генераторы сеток должны следовать форме CAD-модели и размещать узлы середины сторон элементов второго порядка непосредственно на геометрию. Для сложных форм это может привести к чрезмерному растяжению элементов, из-за чего они становятся инвертированными. Якобиан является одной из наиболее распространённых мер качества сетки — он отражает отклонение элемента от его идеальной формы. Он становится отрицательным, когда элемент «выворачивается наизнанку» (инвертируется) — либо вследствие сильной деформации во время анализа (не рассматривается здесь), либо из-за указанных выше проблем при генерации сетки.

Отрицательные якобианы в FreeCAD FEM могут быть обнаружены Gmsh или CalculiX. Их расположение в сетке подсвечивается, когда анализ CalculiX запускается с помощью кнопки [[FEM_SolverRun|Run solver calculations]]. Следующие рекомендации могут помочь устранить проблему:

* установить для свойства ''Second Order Linear'' объекта [[FEM_MeshGmshFromShape|FEMMeshGmsh]] значение ''true'' — в этом случае узлы середины сторон элементов второго порядка просто добавляются в середину прямых (изначально) рёбер элементов первого порядка, без привязки к геометрии, что в большинстве случаев решает проблему;
* использовать Netgen вместо Gmsh — Netgen менее подвержен проблемам с отрицательными якобианами, однако он не сообщает о них, поэтому пользователь может обнаружить их только при запуске анализа;
* дополнительно уменьшить размер элемента;
* экспортировать геометрию и попробовать создать сетку в интерфейсе Gmsh или Netgen (NGSolve) либо в другом отдельном генераторе сеток, таком как Salome_Meca — эти инструменты имеют дополнительные функции для устранения отрицательных якобианов (например, в Gmsh есть так называемые «High-order tools»);
* использовать элементы первого порядка — этот вариант следует рассматривать только как последнее средство, поскольку тетраэдры первого порядка известны своей низкой точностью.

Независимо от приведённых выше рекомендаций, важно ещё раз подчеркнуть, что отрицательные якобианы обычно являются следствием неаккуратного моделирования и отсутствия подготовки геометрии к анализу (особенно часто это встречается в STEP-моделях, загруженных с различных сайтов). Даже если в таких случаях сетку всё же удаётся сгенерировать, результаты, скорее всего, будут низкого качества (вспомните правило GIGO, упомянутое в первом абзаце). Поэтому очистка и подготовка геометрии к анализу в FEM всегда должны быть приоритетом.

<span id="Mesh_convergence_studies"></span>
== Исследования сходимости сетки ==

Исследования сходимости сетки рекомендуются для всех серьёзных проектов, требующих высокой точности результатов. Причина заключается в том, что результаты могут значительно изменяться, приближаясь к корректным значениям по мере уточнения сетки. Следует использовать следующий подход:

# После получения первых результатов и их фиксации (обычно это максимальное эквивалентное напряжение по Мизесу, напряжение по Мизесу в заданной точке и максимальное перемещение) уточните сетку (глобально или, предпочтительно, локально — с помощью [[FEM_MeshRegion|FEM MeshRegion]]) и повторно запустите расчёт.

# Проверьте результаты и запишите их новые значения. Если они существенно отличаются от исходных, выполните дальнейшее уточнение сетки и повторите анализ.

# Повторяйте процесс, если результаты всё ещё заметно (обычно увеличиваются) изменяются при уточнении сетки.

Обычно полезно построить график зависимости интересующего результата от плотности сетки. Это позволяет легче определить момент, когда результаты начинают сходиться. Допустимая разница между результатами двух последовательных расчётов обычно составляет несколько процентов (например, менее 5%).

В некоторых случаях может происходить так, что максимальные напряжения будут расти бесконечно, независимо от того, насколько плотной будет сетка. Такой нефизический эффект называется сингулярностью напряжений. Он может возникать по следующим причинам:

* сосредоточенные силы, приложенные к объёмным или оболочечным моделям;
* граничные условия, заданные в точках (отдельных узлах);
* острые углы;
* контакт, происходящий в угловой точке.

Типичные способы устранения сингулярностей напряжений:

* прикладывать нагрузки и граничные условия к небольшим площадям, а не к точкам — см. раздел о разбиении выше;
* добавлять малые скругления к острым углам (исключение из правила об удалении мелких скруглений при упрощении геометрии для FEM);
* учитывать пластичность материала, чтобы обеспечить перераспределение напряжений и ограничить их значения уровнями, допустимыми определением пластичности, при этом контролируя степень текучести (пластическую деформацию);
* игнорировать сингулярности и анализировать напряжения вдали от них, если это возможно (на основе принципа Сен-Венана).

[[Image:FEM_mesh_convergence.PNG|400px]]

{{Caption|Типичные графики сходимости сетки:<br>

* перемещение ('''зелёная кривая''') сходится быстро,<br>
* максимальное напряжение в области выреза, например отверстия ('''синяя кривая'''), требует больше итераций уточнения сетки для достижения сходимости,<br>
* максимальное напряжение в остром углу с жёстким граничным условием ('''красная кривая''') вообще не сходится. Возникает сингулярность напряжений, и для устранения этого эффекта необходимо добавить малое скругление и смоделировать соединение более реалистичным, гибким образом.<br>}}


{{FEM_Tools_navi{{#translation:}}}}
{{Userdocnavi{{#translation:}}}}