<languages/>
{{TOCright}}

== Introduction ==

FreeCAD peut être exécuté sans son interface utilisateur graphique (GUI), un mode communément appelé « headless » (sans affichage). Cela offre plusieurs méthodes puissantes pour la création de scripts, l'automatisation et l'intégration de ses capacités dans d'autres applications. Cette page documente les différentes façons d'exécuter FreeCAD en mode headless.

<span id="Via_the_FreeCAD_Python_Console"></span>
=== Via la console Python de FreeCAD ===

Il s'agit d'un mode interactif dans lequel FreeCAD démarre directement dans une console Python. Cette console est un environnement Python entièrement fonctionnel avec tous les modules Python de FreeCAD, tels que {{incode|Part}}, {{incode|BIM}} et {{incode|Draft}}, accessibles via leur API publique. Le module central {{incode|FreeCAD}} est intégré, il n'est donc pas nécessaire de l'importer explicitement pendant la session de la console. D'autres modules peuvent être importés pendant la session (par exemple {{incode|import Part}}), selon les besoins.

Ce mode peut être lancé à partir de la ligne de commande en utilisant soit {{incode|FreeCAD -c}} soit {{incode|FreeCADCmd}}. Il offre les mêmes fonctionnalités que la console Python disponible dans l'application FreeCAD complète.

Il est particulièrement adapté pour tester rapidement du code Python qui accède à l'API FreeCAD ou pour déboguer de petits scripts qui peuvent être facilement collés dans la console.

<span id="Via_Python_script"></span>
=== Via un script Python ===

Dans ce mode, FreeCAD est utilisé comme une bibliothèque Python standard. Cela vous permet d'importer l'intégralité de son API Python dans n'importe quel script ou application Python externe, en le traitant comme un module natif.

Pour cela, l'interpréteur Python doit pouvoir localiser le fichier de la bibliothèque de FreeCAD, {{incode|FreeCAD.so}} sous Linux et macOS ou {{incode|FreeCAD.pyd}} sur les autres plateformes. Pour ce faire, ajoutez son répertoire aux chemins de recherche de Python au tout début de votre script. Une fois le chemin défini, le reste du script peut accéder à l'API FreeCAD comme n'importe quel autre module Python.

Voici un exemple simple qui crée une boîte et affiche son volume et sa surface :

{{Code|code=
# Set the path to your FreeCAD installation
# Example for Linux:
# FREECADPATH = '/usr/lib/freecad/lib'
# Example for macOS:
# FREECADPATH = '/Applications/FreeCAD.app/Contents/Resources/lib'
# Example for Windows:
FREECADPATH = 'C:\\Program Files\\FreeCAD\\bin'
import sys
sys.path.append(FREECADPATH)

# The rest of the script can now import and use the FreeCAD API
import FreeCAD
import Part

# Create a simple geometric shape
my_box = Part.makeBox(10, 20, 30)

# Access its properties
print(f"The volume of the box is: {my_box.Volume}")
print(f"The area of the box is: {my_box.Area}")
}}

To run the example script, save the code into a file (e.g., {{incode|run_box.py}}) and execute it from your system's terminal with the Python interpreter:
{{Code|lang=bash|code=
$ python run_box.py
The volume of the box is: 6000.0
The area of the box is: 2200.0
}}

Il s'agit d'une fonction très puissante qui libère tout le potentiel de FreeCAD pour les tâches d'automatisation et d'intégration. Par exemple, on pourrait écrire un script qui exploite à la fois les API FreeCAD et Blender pour importer par programmation des objets depuis un fichier {{incode|.FCStd}} directement dans une scène Blender.

Notez que ce mode est destiné à l'utilisation de l'API FreeCAD sans interface graphique. Bien que certains modules liés à l'interface graphique puissent être importés, l'utilisation de l'API qui accède directement ou manipule les composants de l'interface graphique est très limitée et généralement non prise en charge dans un contexte sans interface graphique.

Voir [[Embedding_FreeCAD/fr|Intégrer FreeCAD]].

<span id="Via_shell_script"></span>
=== Via un script shell ===

Vous pouvez également exécuter FreeCAD sans interface graphique à partir d'un script shell en appelant {{incode|FreeCAD -c}} ou {{incode|FreeCADCmd}} suivi des arguments nécessaires.

Une liste complète des arguments de ligne de commande disponibles peut être affichée à l'aide du drapeau {{incode|--help}}. Voici un exemple de résultat de l'aide pour FreeCAD 1.0.2 :

{| class="wikitable mw-collapsible mw-collapsed" style="width:100%;"
|+ style="text-align: left;" | '''Command-line arguments for FreeCAD 1.0.2 (Click to expand)'''
|-
| {{Code|lang=bash|code=
$ FreeCAD -c --help
FreeCAD

For a detailed description see https://wiki.freecad.org/Start_up_and_Configuration

Usage: FreeCAD [options] File1 File2 ...

Allowed options:

Generic options:
  -v [ --version ]          Prints version string
  --verbose                 Prints verbose version string
  -h [ --help ]             Prints help message
  -c [ --console ]          Starts in console mode
  --response-file arg       Can be specified with '@name', too
  --dump-config             Dumps configuration
  --get-config arg          Prints the value of the requested configuration key
  --set-config arg          Sets the value of a configuration key
  --keep-deprecated-paths   If set then config files are kept on the old 
                            location

Configuration:
  -l [ --write-log ]        Writes FreeCAD.log to the user directory.
  --log-file arg            Unlike --write-log this allows logging to an 
                            arbitrary file
  -u [ --user-cfg ] arg     User config file to load/save user settings
  -s [ --system-cfg ] arg   System config file to load/save system settings
  -t [ --run-test ] arg     Run a given test case (use 0 (zero) to run all 
                            tests). If no argument is provided then return list
                            of all available tests.
  -r [ --run-open ] arg     Run a given test case (use 0 (zero) to run all 
                            tests). If no argument is provided then return list
                            of all available tests.  Keeps UI open after 
                            test(s) complete.
  -M [ --module-path ] arg  Additional module paths
  -E [ --macro-path ] arg   Additional macro paths
  -P [ --python-path ] arg  Additional python paths
  --disable-addon arg       Disable a given addon.
  --single-instance         Allow to run a single instance of the application
  --safe-mode               Force enable safe mode
  --pass arg                Ignores the following arguments and pass them 
                            through to be used by a script
}}
|}

Cette méthode est idéale pour les tâches automatisées et les scripts d'intégration continue (CI). Elle est couramment utilisée pour exécuter l'ensemble des tests avec {{incode|FreeCADCmd -t 0}} ou pour exécuter les tests d'un module spécifique, tel que {{incode|FreeCADCmd -t TestArch}} (tous les tests de l'atelier BIM) ou {{incode|FreeCADCmd -t TestArch.TestWall}} (uniquement les tests relatifs aux murs de l'atelier BIM).

<span id="Executing_Python_code_directly"></span>
==== Exécuter directement du code Python ====

Les exécutables en ligne de commande de FreeCAD peuvent également fonctionner comme des interpréteurs Python spécialisés, permettant l'exécution directe de code Python. Cela offre une alternative pratique et puissante à l'intégration de FreeCAD dans un script Python externe.

'''Exécuter un script en ligne'''

Vous pouvez transmettre une chaîne de code Python directement en tant qu'argument unique. Cela est utile pour les commandes très courtes et à usage unique. Notez que l'argument de ligne de commande ne doit pas être un chemin d'accès à un fichier existant pour que cela fonctionne.

* '''Mode headless''': l'utilisation de {{incode|FreeCADCmd}} exécute le code puis quitte immédiatement. Ce mode est idéal pour les scripts.
{{Code|lang=bash|code=
$ FreeCADCmd "import Part; print(Part.makeBox(10,5,15).Volume)"
}}
* '''Mode interactif''': l'utilisation de {{incode|FreeCAD -c}} exécute le code puis ouvre une session interactive de console Python. Ceci est utile pour des tests rapides où vous souhaitez inspecter l'état après coup.
{{Code|lang=bash|code=
$ FreeCAD -c "import Part; my_box = Part.makeBox(10,5,15)"
}}

'''Exécuter un fichier script'''

Une méthode plus puissante consiste à utiliser FreeCAD pour exécuter directement un fichier script Python. C'est l'approche recommandée pour toute tâche non triviale sans interface graphique.

{{Code|lang=bash|code=
$ FreeCADCmd /path/to/my_script.py
}}

Lorsqu'un script est exécuté de cette manière, l'environnement FreeCAD est déjà configuré. L'avantage principal est que le script n'a pas besoin du code standard {{incode|sys.path.append()}}. Les modules FreeCAD sont immédiatement disponibles pour l'importation.

Par exemple, un fichier nommé {{incode|create_box.py}} pourrait contenir :
{{Code|lang=python|code=
import Part
# Le module FreeCAD est déjà disponible, mais il peut être importé explicitement.
import FreeCAD

# Créer un nouveau document et y ajouter une boîte
doc = FreeCAD.newDocument()
box_obj = doc.addObject("Part::Box", "MyBox")
doc.recompute()

# Exporter la pièce vers un fichier STEP
Part.export([box_obj], "my_box_model.step")

print("Boîte créée et exportée avec succès vers my_box_model.step")
}}
Pour exécuter ce script depuis le terminal, il suffit de taper :
{{Code|lang=bash|code=
$ FreeCADCmd create_box.py
Boîte créée et exportée avec succès vers my_box_model.step
}}

<span id="Examples"></span>
== Exemples ==

<span id="Searching_FreeCAD_modules"></span>
=== Recherche des modules FreeCAD ===

# Ouvrez le terminal et tapez :
#:{{incode|$ /path/to/FreeCAD -c}}
#::ou
#:{{incode|$ /path/to/FreeCADCmd}}
# Un shell python démarre avec une invite. Tapez {{incode|help()}}.
# Un texte d'aide s'affiche.
# Tapez {{incode|modules freecad}}.

<span id="Scenegraph_representation"></span>
== Représentation du graphe de scène ==

Comme il n'est pas possible de créer ou d'accéder au [[Viewprovider/fr|fournisseur de vues]] en mode headless, ce qui est possible, c'est de charger {{incode|FreeCADGui}} en mode headless, mais il n'y a aucun moyen d'accéder au document GUI car il ne sera pas créé et, par conséquent, il n'existe aucun fournisseur de vues.

Cependant, il est possible de créer une représentation du [[Scenegraph/fr|Graphe de scène]] d'un objet :

{{Code|lang=python|code=
import FreeCADGui as Gui
from pivy import coin

Gui.setupWithoutGUI()
doc = App.newDocument()
obj = doc.addObject("Part::Box","Box")
doc.recompute()
view = Gui.subgraphFromObject(obj)
}}

Voir : [https://forum.freecad.org/viewtopic.php?f=10&t=55794&p=481586#p481586 fil du forum].

<span id="Related"></span>
== En relation ==

* [[Embedding_FreeCAD/fr#Utilisation_de_FreeCAD_sans_interface_graphique_.28GUI.29|Intégrer FreeCAD]]
* [[Start_up_and_Configuration/fr#Executer_FreeCAD_sans_interface_graphique_utilisateur|Démarrage et configuration]]


[[Category:Developer Documentation{{#translation:}}]]
[[Category:Poweruser Documentation{{#translation:}}]]