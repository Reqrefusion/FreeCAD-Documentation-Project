<languages/>

{{Docnav/fr
|[[BIM_Material/fr|Matériau]]
|[[Arch_Schedule/fr|Nomenclature]]
|[[BIM_Workbench/fr|Atelier BIM]]
|IconL=BIM_Material.svg
|IconR=Arch_Schedule.svg
|IconC=Workbench_BIM.svg
}}

{{GuiCommand/fr
|Name=BIM Report
|Name/fr=BIM Rapport
|MenuLocation=Gestion → Outils de rapport → Rapport BIM
|Workbenches=[[BIM_Workbench/fr|BIM]]
|Version=1.2
|SeeAlso=
}}

== Description ==

Le '''BIM Rapport''' est un outil permettant de générer des calendriers et des rapports de données à partir d'un modèle FreeCAD. Il utilise un langage de requête de type SQL pour sélectionner, filtrer et agréger des données, offrant ainsi une alternative déclarative aux autres outils de planification. Au final, il permet aux utilisateurs de créer et de remplir automatiquement une [[Spreadsheet_Workbench/fr|feuille de calcul]] avec les données recueillies à partir du modèle.

Vous pourriez utiliser l'outil BIM Rapport lorsque vous devez effectuer les opérations suivantes :
* '''Filtrage complexe :''' sélectionner des objets en fonction d'une combinaison de propriétés, y compris des données imbriquées (par exemple, les coordonnées de placement d'un objet).
* '''Agrégation de données :''' calculer les totaux, les nombres, les minimums ou les maximums pour plusieurs objets (par exemple, trouver la surface totale de tous les objets « Espace »).
* '''Requêtes hiérarchiques :''' sélectionner des objets en fonction de leur relation avec d'autres objets (par exemple, trouver toutes les fenêtres situées dans les murs d'un niveau spécifique).

<span id="Usage"></span>
== Utilisation ==

# Ouvrez ou créez un document FreeCAD contenant des objets.
# Il existe plusieurs façons de lancer l'outil :
#* Appuyez sur le bouton {{Button|[[Image:BIM_Report.svg|16px]] [[BIM_Report|Rapport BIM]]}}.
#* Sélectionnez l'option {{MenuCommand|Gestion → Outils de rapport → [[Image:BIM_Report.svg|16px]] Rapport BIM}} du menu.
# Le nouveau rapport ouvrira automatiquement son panneau de tâches. Créez une ou plusieurs instructions pour le rapport. Vous pouvez utiliser l'éditeur d'instructions fourni pour voir un aperçu de l'exécution de ces instructions.
# Appuyez sur {{Button|OK}} pour enregistrer le rapport et actualiser la feuille de calcul associée avec les résultats de la requête.

<span id="User_interface"></span>
=== Interface utilisateur ===

Le Rapport BIM se compose de trois éléments principaux : l'objet '''Report''' dans l'arborescence, la '''feuille de calcul''' cible pour les résultats et le '''panneau des tâches''' où vous configurez le rapport.

Lorsque vous créez un nouveau rapport, deux nouveaux objets apparaissent dans '''l'arborescence''' : l'objet Report, qui stocke tous vos paramètres, et la feuille de calcul ReportResult qui lui est associée.

Un double-clic sur l'objet {{PropertyData|Report}} ouvre le '''panneau des tâches''', qui est l'espace de travail principal pour la modification de votre rapport. Le panneau est divisé en deux zones principales : '''Rapport des requêtes''' et '''Éditeur de requêtes'''.

[[File:BIM_Report_Task_Panel_Overview.png|thumb|Le panneau des tâches du rapport BIM, avec la section des aperçus des requêtes en haut.]]

<span id="Report_Statements"></span>
==== Rapport des requêtes ====

Cette section est toujours visible en haut du panneau des tâches et vous donne un résumé de toutes les requêtes (ou « instructions ») qui composent votre rapport.

La principale fonction est un '''tableau''' répertoriant chaque requête. À partir de là, vous pouvez voir et modifier directement la '''Description''' et activer/désactiver les options clés pour chaque requête :
* '''Pipeline : active le mode pipeline pour cette requête, en utilisant la sortie de la précédente comme entrée.
* '''En-tête''' : utilise la description de requête comme en-tête de section fusionnée dans la feuille de calcul.
* '''Colonnes''' : inclut les noms de colonnes (par exemple, {{Incode|Étiquette}}, {{Incode|Surface}}) comme ligne d'en-tête pour les résultats de cette requête.

Double-cliquez sur une ligne de requête pour ouvrir la requête et la modifier. Appuyez sur {{KEY|F2}} sur une ligne de requête pour modifier la description de la requête sans charger l'éditeur complet.

Sous le tableau se trouvent les boutons {{Button|[[Image:List-add.svg|16px]] Ajouter}}, {{Button|[[Image:List-remove.svg|16px]] Supprimer}}, {{Button|[[Image:Edit-copy.svg|16px]] Dupliquer}} ou {{Button|[[Image:Edit-edit.svg|16px]] Modifier}} la requête sélectionnée.

Enfin, le menu déroulant '''Modèles de rapport''' vous permet de charger des rapports complets et préconfigurés, tels que '''Nomenclature des pièces et surfaces'''.

<span id="Statement_Editor"></span>
==== Éditeur de requêtes ====

Cette section apparaît au bas du panneau des tâches lorsque vous sélectionnez une requête et cliquez sur {{Button|[[Image:Edit-edit.svg|16px]] Modifier la sélection}}. C'est ici que vous écrivez et configurez une requête SQL.

[[File:BIM_Report_Statement_Editor.png|thumb|L'éditeur de requêtes, affichant l'éditeur SQL, le volet d'aperçu et les options d'affichage.]]

* L'éditeur de requêtes SQL est une zone de texte avec la mise en évidence de la syntaxe. La saisie automatique des mots-clés SQL et des noms de propriétés de votre modèle est automatiquement activée. Utilisez les touches {{KEY|↑}} et {{KEY|↓}} selon vos besoins, puis appuyez sur la touche {{KEY|Tab}} pour appliquer la suggestion choisie.
* Sous l'éditeur, une étiquette d'état '''Mise à jour automatique''' vous donne un retour immédiat, indiquant si votre syntaxe est valide et affichant un compte en direct des objets correspondants.
* Le bouton {{Button|[[Image:Std_ToggleVisibility.svg|16px]] Afficher l'aperçu}} exécute la requête en cours suite à la demande et affiche l'intégralité des résultats dans un tableau temporaire, vous permettant de tester votre requête sans fermer l'éditeur.
* Le bouton {{Button|[[Image:Help-browser.svg|16px]] Aide}} ouvre une boîte de dialogue contenant une « fiche de référence » de toutes les clauses et fonctions SQL prises en charge.
* Le groupe '''Options d'affichage''' contient des cases à cocher permettant de contrôler la mise en forme finale dans la feuille de calcul :
** {{CheckBox|Utiliser en mode pipeline}} : lorsque cette option est cochée, cette instruction utilisera les résultats de la requête précédente comme source de données au lieu d'interroger l'ensemble du document. Il s'agit du contrôle clé pour activer les flux de travail de pipeline.
** {{CheckBox|Utiliser la description comme en-tête de section}} : lorsque cette option est cochée, la description de la requête (par exemple, « Liste des pièces ») sera écrite sous forme de ligne d'en-tête fusionnée et centrée dans la feuille de calcul avant ses résultats de données.
** {{CheckBox|TRUE|Inclure les noms des colonnes}} : cette option, activée par défaut, inclut les en-têtes de colonnes (par exemple, {{Incode|Étiquette}}, {{Incode|Surface}}).
** {{CheckBox|Ajouter une ligne vide après}} : lorsque cette option est cochée, une ligne vide est insérée après les résultats de cette requête, ce qui permet de séparer visuellement les différentes sections d'un rapport.
** {{CheckBox|Afficher les résultats en gras}} : affiche les cellules des données correspondant aux résultats de cette requête en gras pour les mettre en évidence.
* Le menu déroulant '''Préréglages de requête''' vous permet de charger et d'enregistrer des requêtes SQL couramment utilisées.

Le bouton {{Button|[[Image:Document-save.svg|16px]] Enregistrer}} enregistre les modifications apportées à la requête chargée. Lorsque la case {{CheckBox|Enregistrer et suivant}} est cochée et que le bouton {{Button|[[Image:Document-save.svg|16px]] Enregistrer}} est enfoncé, en plus de l'opération d'enregistrement, une nouvelle requête est créée pour une édition plus fluide. Le bouton {{Button|❌ Annuler}} ferme l'éditeur de requêtes sans enregistrer les modifications apportées.

<span id="Workflow"></span>
== Flux de travail ==

Ce petit tutoriel vous guide dans la création d'une nomenclature complète pour une pièce, depuis une simple liste jusqu'à un rapport en plusieurs parties avec des totaux calculés.

<span id="Step_1:_New_report"></span>
=== Étape 1 : Nouveau rapport ===

# Cliquez sur le bouton {{Button|[[Image:BIM_Report.svg|16px]] [[BIM_Report/fr|Rapport BIM]]}} dans la barre d'outils de l'atelier BIM.
# FreeCAD créera un '''objet Report''' et une '''feuille de calcul ReportResult''' dans l'arborescence et ouvrira automatiquement le panneau des tâches.

<span id="Step_2:_Simple_statement"></span>
=== Étape 2 : Requête simple ===

Tout d'abord, créons une liste simple de tous les espaces et de leurs superficies.
# Dans '''Rapport des requêtes''', cliquez sur le bouton {{Button|[[Image:List-add.svg|16px]] Ajouter une requête}}. Une nouvelle requête vide apparaîtra dans la liste.
# Une fois la nouvelle requête sélectionnée, cliquez sur le bouton {{Button|[[Image:Edit-edit.svg|16px]] Modifier la sélection}}. L'éditeur de requête apparaîtra au bas du panneau des tâches.
# Dans le champ '''Description''', tapez {{Incode|Liste des pièces}}.
# Dans l'éditeur '''Requête SQL''', saisissez la requête suivante. Cela sélectionne le nom et la surface de tous les objets {{Incode|Space}} et les trie par ordre alphabétique.{{Code|lang=sql|code=SELECT Label, Area FROM document WHERE IfcType = 'Space' ORDER BY Label ASC}}
# Cliquez sur le bouton {{Button|[[Image:Document-save.svg|16px]] Enregistrer}} dans l'éditeur pour valider vos modifications dans la requête.

<span id="Step_3:_Multi-section_report"></span>
=== Étape 3 : Rapport en plusieurs sections ===

Maintenant, ajoutons une deuxième requête pour calculer la superficie totale.
# Dans l'aperçu, cliquez à nouveau sur {{Button|[[Image:List-add.svg|16px]] Ajouter une requête}} pour créer une deuxième requête.
# Une fois cette nouvelle requête sélectionnée, cliquez sur {{Button|[[Image:Edit-edit.svg|16px]] Modifier la sélection}}.
# Définissez la '''Description''' sur {{Incode|Surface totale}}.
# Dans l'éditeur '''Requête SQL''', saisissez cette requête d'agrégation :{{Code|lang=sql|code=SELECT 'Total Usable Area', SUM(Area) FROM document WHERE IfcType = 'Space'}}
# Sous '''Options d'affichage''', décochez '''Inclure les noms de colonnes''' (car notre première colonne est une étiquette personnalisée) et cochez '''Afficher les résultats en gras''' pour les mettre en évidence.
# Cliquez sur {{Button|[[Image:Document-save.svg|16px]] Enregistrer}}. Vous disposez désormais d'un rapport à deux requêtes. Cliquez sur le bouton principal {{Button|OK}} en bas du panneau des tâches pour l'exécuter. La feuille de calcul associée s'ouvrira automatiquement avec les résultats formatés.

<span id="Step_4:_Pipelining_for_advanced_queries"></span>
=== Étape 4 : Pipelining pour les requêtes avancées ===

Le pipelining vous permet d'enchaîner des requêtes, où le résultat d'une requête devient l'entrée de la suivante. Cela est essentiel pour les sélections hiérarchiques complexes, comme lors de l'utilisation de la fonction {{Incode|CHILDREN()}}. Comme il n'est pas récursif, il ne trouve que les descendants directs.

Par exemple, pour trouver toutes les portes situées au « rez-de-chaussée », vous devez effectuer une requête en plusieurs étapes, car les portes sont des enfants des murs, qui sont eux-mêmes des enfants du sol.

# Créer un nouveau rapport.
# '''Requête 1 : trouver l'objet « Ground Floor »'''
#* Ajouter une instruction avec la description {{Incode|Find Ground Floor}}.
#* Cette requête sélectionne le point de départ de notre recherche. {{Code|lang=sql|code=SELECT * FROM document WHERE Label = 'Ground Floor'}}
# '''Requête 2 : trouver les murs de cet étage'''
#* Ajoutez une deuxième instruction avec la description {{Incode|Find Walls on Floor}}.
#* Dans l'éditeur, cochez la case {{CheckBox|Use as Pipeline Step}}. Cela indique à l'instruction de s'exécuter sur les résultats de la précédente (l'objet étage).
#* Utilisez cette requête pour trouver tous les enfants directs de l'étage et ne conserver que les murs : {{Code|lang=sql|code=SELECT * FROM CHILDREN(SELECT * FROM document) WHERE IfcType = 'Wall'}}
# '''Requête 3 : trouver les portes dans ces murs'''
#* Ajoutez une troisième requête avec la description {{Incode|Find Doors in Walls}}.
#* Cochez à nouveau la case {{CheckBox|Utiliser en mode pipeline}}. Cela permet désormais de la lier au résultat de la requête 2 (la liste des murs).
#* Utilisez cette requête pour trouver les enfants des murs et ne conserver que les portes : {{Code|lang=sql|code=SELECT Label, Width, Height FROM CHILDREN(SELECT * FROM document) WHERE IfcType = 'Door'}}
# Cliquez sur {{Button|OK}}. Le rapport exécutera l'intégralité du pipeline en trois étapes.

'''Comprendre le résultat :''' la feuille de calcul finale n'affichera que les résultats de la dernière requête du pipeline (la liste des portes). Les deux premières requêtes agissent comme des filtres intermédiaires dont les résultats sont transmis en mémoire mais ne sont pas affichés dans la feuille de calcul, ce qui vous permet d'obtenir un rapport final clair et précis.

<span id="Step_5:_Presets_and_templates"></span>
=== Étape 5 : Préréglages et modèles ===

* Les '''modèles de rapport''' chargent un rapport complet à plusieurs instructions. Dans le '''Rapport des requêtes''', sélectionnez un modèle tel que « Nomenclature des pièces et surfaces » dans le menu déroulant pour charger instantanément la configuration des étapes 2 et 3. Vous pouvez enregistrer vos propres rapports en tant que nouveaux modèles afin de les réutiliser.
* Les '''préréglages de requête''' chargent une seule requête dans l'éditeur. Dans l''''Éditeur de requêtes''', sélectionnez un préréglage tel que « Tous les murs » dans le menu déroulant pour remplir l'éditeur SQL. Vous pouvez enregistrer vos propres requêtes fréquemment utilisées en cliquant sur le bouton {{Button|Enregistrer…}}.

<span id="BIM_SQL_dialect_reference"></span>
== Référence du dialecte SQL BIM ==

Cette section fournit une référence détaillée pour le dialecte SQL utilisé par l'outil BIM Rapport.

'''Remarque''': la référence la plus récente pour toutes les clauses et fonctions est toujours disponible dans l'interface utilisateur en cliquant sur le bouton {{Button|[[Image:Help-browser.svg|16px]] Aide}} dans l'éditeur du panneau des tâches du rapport.

=== Clauses ===

* {{Incode|SELECT}} : spécifie les colonnes de données à renvoyer. Vous pouvez utiliser {{Incode|*}} pour sélectionner un identifiant par défaut pour tous les objets.
* {{Incode|FROM}} : spécifie la source des données. Dans une seule requête, il s'agit toujours de {{Incode|document}}. Dans un pipeline, {{Incode|document}} est un espace réservé pour les données de l'étape précédente. Vous pouvez également utiliser la fonction {{Incode|CHILDREN()}}.
* {{Incode|WHERE}} : filtre les objets en fonction de conditions.
* {{Incode|GROUP BY}} : regroupe les lignes qui ont les mêmes valeurs en lignes récapitulatives, généralement utilisées avec des fonctions d'agrégation.
* {{Incode|ORDER BY}} : trie les résultats finaux. Peut être suivi de {{Incode|ASC}} (ascendant, par défaut) ou {{Incode|DESC}} (descendant). Prend en charge le tri par plusieurs colonnes.
* {{Incode|AS}} : crée un alias (un nom personnalisé) pour une colonne dans la clause {{Incode|SELECT}}, par exemple {{Incode|SELECT Area AS "My Area"}}.

<span id="Usage_notes_for_GROUP_BY_and_ORDER_BY"></span>
==== Remarques d'utilisation pour GROUP BY et ORDER BY ====

Le dialecte a des règles spécifiques pour l'utilisation des expressions (comme les fonctions ou l'arithmétique) dans les clauses {{Incode|GROUP BY}} et {{Incode|ORDER BY}}.

* '''Pour {{Incode|GROUP BY}} :''' lorsque vous effectuez un regroupement par expression, vous devez répéter l'expression entière dans la clause {{Incode|GROUP BY}}. L'utilisation d'un alias provenant de la liste {{Incode|SELECT}} n'est pas prise en charge.
** ✅ '''Correct :''' {{Code|lang=sql|code=SELECT TYPE(*) … GROUP BY TYPE(*)}}
** ❌ '''Non correct :''' {{Code|lang=sql|code=SELECT TYPE(*) AS BimType … GROUP BY BimType}}

* '''Pour {{Incode|ORDER BY}} :''' à l'inverse, le tri par expression brute n'est pas pris en charge. Pour trier par le résultat d'une expression, vous '''devez''' d'abord l'inclure dans la liste {{Incode|SELECT}} avec un alias {{Incode|AS}}, puis faire référence à cet alias dans la clause {{Incode|ORDER BY}}.
** ✅ '''Correct :'''{{Code|lang=sql|code=SELECT Label, LOWER(Label) AS sort_key … ORDER BY sort_key}}
** ❌ '''Non correct :'''{{Code|lang=sql|code=SELECT Label … ORDER BY LOWER(Label)}}

<span id="Functions"></span>
===Fonctions===

Le dialecte comprend une bibliothèque de fonctions intégrées pour la manipulation et l'analyse des données.
{| class="wikitable"
! Catégorie
! Fonction
! Description
|-
| '''Agrégat'''
| {{Incode|COUNT(property<nowiki>|</nowiki>*)}}
| Compte le nombre d'objets. {{Incode|COUNT(*)}} compte toutes les lignes ; {{Incode|COUNT(property)}} compte les lignes où la propriété spécifiée n'est pas {{Incode|NULL}}.
|-
|
| {{Incode|SUM(propriété)}}
| Calcule la somme d'une propriété numérique.
|-
|
| {{Incode|MIN(propriété)}}
| Trouve la valeur minimale d'une propriété numérique.
|-
|
| {{Incode|MAX(propriété)}}
| Trouve la valeur maximale d'une propriété numérique.
|-
| '''Hiérarchique'''
| {{Incode|PARENT(*)}}
| Renvoie le parent architecturalement significatif d'un objet (par exemple, le mur dans lequel se trouve une fenêtre), en ignorant de manière transparente les groupes génériques.
|-
|
| {{Incode|CHILDREN(sous-requête)}}
| Fonction utilisée dans la clause {{Incode|FROM}}. Renvoie tous les enfants des objets trouvés par la sous-requête, en résolvant à la fois les relations de contenance ({{Incode|.Group}}) et d'hébergement ({{Incode|.Hosts}}). Cette fonction n'est '''pas récursive'''. Pour trouver les petits-enfants ou les descendants plus éloignés, enchaînez plusieurs étapes {{Incode|CHILDREN()}} à l'aide d'un pipeline.
|-
|
| {{Incode|CHILDREN_RECURSIVE(sous-requête, max_depth{{:=}}15)}}
| Une fonction utilisée dans la clause {{Incode|FROM}}. Renvoie tous les objets descendants des résultats de la {{Incode|sous-requête}} en parcourant de manière récursive la hiérarchie. Elle ignore de manière transparente les groupes génériques. Une option {{Incode|max_depth}} peut être spécifiée.
|-
| '''Utilitaire'''
| {{Incode|TYPE(*)}}
| Renvoie le type de l'objet visible par l'utilisateur, tel que déterminé par son proxy (par exemple, {{Incode|Wall}}, {{Incode|Space}}, {{Incode|Part::Box}}).
|-
|
| {{Incode|CONVERT(quantity, 'unit')}}
| Convertit un objet Quantité FreeCAD en une nouvelle unité et le renvoie sous forme de nombre brut. Exemple : {{Incode|CONVERT(Area, 'm^2')}}.
|-
| '''Chaîne'''
| {{Incode|LOWER(propriété)}}
| Convertit une propriété texte en minuscules.
|-
|
| {{Incode|UPPER(propriété)}}
| Convertit une propriété texte en majuscules.
|-
|
| {{Incode|CONCAT(val1, val2, …)}}
| Concatène plusieurs valeurs et propriétés texte en une seule chaîne.
|}

<span id="Property_access"></span>
=== Accès aux propriétés ===

Vous pouvez accéder à n'importe quelle propriété d'un objet, y compris aux structures de données imbriquées.

* '''Accès direct :''' accédez directement à une propriété simple par son nom.
** Exemple : {{Incode|Label}}, {{Incode|IfcType}}
* '''Accès imbriqué :''' utilisez la notation par points pour accéder aux sous-propriétés.
** Exemple : {{Incode|Shape.Volume}}, {{Incode|Placement.Base.z}}
* '''Accès en chaîne :''' enchaînez l'accès aux propriétés sur le résultat d'une fonction, le plus souvent {{Incode|PARENT()}}.
** Exemple : {{Incode|PARENT(*).Label}}, {{Incode|PARENT(*).PARENT(*).Height}}

<span id="Operators"></span>
=== Opérateurs ===

{| class="wikitable"
! Type
! Opérateurs
! Description
|-
| '''Comparaison'''
| {{Incode|{{:=}}}}, {{Incode|!{{:=}}}}, {{Incode|>}}, {{Incode|<}}, {{Incode|>{{:=}}}}, {{Incode|<{{:=}}}}
| Opérateurs de comparaison standard.
|-
|
| {{Incode|LIKE}}
| Correspondance de motifs sans distinction de casse. Utilisez {{Incode|%}} pour plusieurs caractères et {{Incode|_}} pour un seul caractère.
|-
|
| {{Incode|IS NULL}}, {{Incode|IS NOT NULL}}
| Vérifie si une propriété a une valeur.
|-
|
| {{Incode|IN (valeur1, valeur2, …)}}
| Vérifie si la valeur d'une propriété figure dans une liste donnée de littéraux.
|-
| '''Logique'''
| {{Incode|AND}}, {{Incode|OR}}
| Utilisé dans la clause {{Incode|WHERE}} pour combiner plusieurs conditions.
|-
| '''Arithmétique'''
| {{Incode|+}}, {{Incode|-}}, {{Incode|*}}, {{Incode|/}}
| Effectue des calculs sur des propriétés numériques. Respecte la priorité standard des opérateurs ; utilisez {{Incode|()}} pour la remplacer.
|}

<span id="General_syntax"></span>
=== Syntaxe générale ===

* '''Littéraux et guillemets''': les guillemets simples ({{Incode|'}}) et doubles ({{Incode|"}}) peuvent tous deux être utilisés pour les littéraux textuels (chaînes de caractères). Par exemple, {{Incode|WHERE Label {{:=}} 'Wall'}} et {{Incode|WHERE Label {{:=}} "Wall"}} sont équivalents.
* '''Commentaires''': le parseur ignore les commentaires sur une seule ligne, qui commencent par {{Incode|--}}, et les commentaires sur plusieurs lignes, qui sont encadrés par  {{Incode|/* … */}}.
* '''Internationalisation''': le parseur gère correctement les caractères non ASCII (Unicode) dans les noms de propriétés (par exemple, Fläche).

<span id="Sample_queries"></span>
==  Exemples de requêtes ==

Cette section fournit une série de requêtes pratiques que vous pouvez utiliser directement ou modifier pour vos rapports.

<span id="Basic_selections"></span>
=== Sélections de base ===

'''Sélectionner tous les éléments structurels (colonnes et poutres) :''

{{Code|lang=sql|code=
SELECT Label, IfcType 
FROM document 
WHERE IfcType IN ('Column', 'Beam') 
ORDER BY IfcType, Label
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Select all walls with "Exterior" in their name:'''
</div>

{{Code|lang=sql|code=
SELECT Label, Length, Height 
FROM document 
WHERE IfcType = 'Wall' AND Label LIKE '%Exterior%'
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
=== Data aggregation & summaries ===
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Count all BIM objects, grouped by their type:'''
</div>

{{Code|lang=sql|code=
SELECT IfcType, COUNT(*) 
FROM document 
WHERE IfcType IS NOT NULL 
GROUP BY IfcType 
ORDER BY IfcType ASC
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Get a full quantity takeoff for all walls:'''
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
This query calculates the total number of walls, their combined length, and the minimum and maximum wall heights.
</div>

{{Code|lang=sql|code=
SELECT 
    COUNT(*) AS "Total Count", 
    SUM(Length) AS "Total Length (mm)", 
    MIN(Height) AS "Min Height (mm)", 
    MAX(Height) AS "Max Height (mm)" 
FROM document 
WHERE IfcType = 'Wall'
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
=== Hierarchical queries ===
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
'''List all objects located directly on the "Ground Floor":'''
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
This uses the {{Incode|CHILDREN()}} function to query the contents of a specific container object.
</div>

{{Code|lang=sql|code=
SELECT Label, IfcType 
FROM CHILDREN(SELECT * FROM document WHERE Label = 'Ground Floor') 
ORDER BY IfcType
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
'''List all doors and the specific wall they are hosted in:'''
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
This uses the {{Incode|PARENT()}} function to find the host of each door.
</div>

{{Code|lang=sql|code=
SELECT 
    Label AS "Door_Name", 
    PARENT(*).Label AS "Host_Wall_Name" 
FROM document 
WHERE IfcType = 'Door' 
ORDER BY "Host_Wall_Name"
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Find all windows on the "Ground Floor" (by checking the grandparent):'''
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
This query finds windows, checks their parent (the wall), and then checks that wall's parent (the floor).
</div>

{{Code|lang=sql|code=
SELECT Label 
FROM document 
WHERE IfcType = 'Window' AND PARENT(*).PARENT(*).Label = 'Ground Floor'
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
=== Advanced queries ===
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Generate a complete room and area schedule:'''
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
This query produces a formatted list of all spaces, grouped by the floor they belong to, with their area converted to square meters.
</div>

{{Code|lang=sql|code=
SELECT 
    PARENT(*).Label AS "Floor", 
    Label AS "Room Name", 
    CONVERT(Area, 'm^2') AS "Area (m²)" 
FROM document 
WHERE IfcType = 'Space' 
ORDER BY "Floor", "Room Name"
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
== Usage notes ==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
=== Units ===
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
When you select a property that has units (a `Quantity`), such as `Length` or `Area`, the BIM Report engine returns the raw numerical value of that property as it is stored internally in the FreeCAD document. FreeCAD's internal units are always based on millimeters ({{Incode|mm}}).
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
This means the default output will be in {{Incode|mm}} for length, {{Incode|mm²}} for area, and {{Incode|mm³}} for volume, regardless of your current unit schema or user preferences. The automatically generated column header will correctly reflect this internal unit.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Example: Default Behavior'''
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
If you run this simple query on a space that is 1 meter by 1 meter:
</div>

{{Code|lang=sql|code=
SELECT Label, Area FROM document WHERE IfcType = 'Space'
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
The resulting spreadsheet will show:
* '''Header:''' {{Incode|Area (mm²)}}
* '''Value:''' {{Incode|1000000.0}}
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
==== Using {{Incode|CONVERT()}} ====
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
To get the results in the units you desire, you can use the {{Incode|CONVERT()}} function, which provides explicit control over the output. To obtain the area in square meters, modify the query as follows:
</div>

{{Code|lang=sql|code=
SELECT Label, CONVERT(Area, 'm^2') AS "Area (m²)" FROM document WHERE IfcType = 'Space'
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
This query now produces the result in the desired unit:
* '''Header:''' {{Incode|Area (m²)}}
* '''Value:''' {{Incode|1.0}}
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
Using {{Incode|CONVERT()}} guarantees that your report's output is unambiguous and that any calculations you perform within the query (e.g., {{Incode|SUM(CONVERT(Area, 'm^2'))}}) are mathematically correct.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
== Properties ==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
An Arch Report object exposes the following properties to the user.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
=== Data ===
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
{{TitleProperty|Report}}
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
* {{PropertyData|AutoUpdate}}: This property, True by default, controls whether the report automatically re-runs every time the document is recomputed. When enabled, the report spreadsheet will always be in sync with the model. For example, if a wall's length is changed, a {{Incode|SUM(Length)}} value in the report will update automatically after the recompute. On very large models, it may be desirable to disable this for performance reasons while making many changes. If AutoUpdate is set to False, the report can be updated manually at any time by right-clicking the Report object in the Tree View and selecting Recompute, or by pressing the global Recompute button.
* {{PropertyData|Target}}: holds a link to the Spreadsheet object where the report's results will be written. When creating a new report, a new spreadsheet is automatically created and linked here. This property can be changed to target a different, existing spreadsheet in the current document if so desired.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
== Scripting ==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
The BIM Report engine is fully accessible through Python, allowing you to integrate its advanced query capabilities into your own scripts and automations.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
=== Arch.selectObjects(query_string) ===
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
This is the primary function for executing a single, straightforward SQL query. It takes a query string as input and returns a list of the FreeCAD DocumentObjects that match the query. If the query is invalid or finds no objects, it returns an empty list and prints an error to the console.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Example: Get all Wall objects with "Exterior" in their name'''
</div>

{{Code|code=
import FreeCAD
import Arch

# This query selects all Wall objects whose Label contains the substring "Exterior"
query = "SELECT * FROM document WHERE IfcType = 'Wall' AND Label LIKE '%Exterior%'"

exterior_walls = Arch.selectObjects(query)

# The result is a list of FreeCAD objects
FreeCAD.Console.PrintMessage(f"Found {len(exterior_walls)} exterior walls.\n")
for wall in exterior_walls:
    FreeCAD.Console.PrintMessage(f"- {wall.Label} (Length: {wall.Length})\n")
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
=== Arch.selectObjectsFromPipeline(statements) ===
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
For more complex, multi-step selections, you can use this function to execute a pipeline. It takes a list of {{Incode|ArchSql.ReportStatement}} objects and returns the final list of FreeCAD DocumentObjects that result from the full pipeline.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
This is the programmatic equivalent of using the '''"Use as Pipeline Step"''' checkbox in the UI.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Example: Find all doors on the "Ground Floor"'''
This is a classic hierarchical problem that requires multiple steps. The goal is to find the "grandchildren" (doors) of a "grandparent" (the floor). Since the {{Incode|CHILDREN()}} function is not recursive, we must chain multiple steps in a pipeline.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
# First, we find the {{Incode|'Ground Floor'}} object.
# Second, we find its direct children (the walls, spaces, etc.).
# Third, we find the children of ''those'' objects (which will include the doors and windows hosted by the walls).
# Finally, we filter that last group to keep only the doors.
</div>

{{Code|code=
import FreeCAD
import Arch
import ArchSql

# Step 1: Define the pipeline statements.
# The ReportStatement class must be imported from the ArchSql module.

# Statement 1: Find the parent 'Ground Floor' object.
# Output of this step: [Ground_Floor_Object]
stmt1 = ArchSql.ReportStatement(
    query_string="SELECT * FROM document WHERE Label = 'Ground Floor'"
)

# Statement 2: Find the direct children of the floor (walls, spaces, etc.).
# is_pipelined=True tells this to run on the output of stmt1.
# Output of this step: [Wall_Object_1, Wall_Object_2, Space_Object_1, …]
stmt2 = ArchSql.ReportStatement(
    query_string="SELECT * FROM CHILDREN(SELECT * FROM document)",
    is_pipelined=True
)

# Statement 3: Find the children of the objects from the previous step.
# This finds the doors and windows hosted by the walls.
# Output of this step: [Door_Object, Window_Object_1, …]
stmt3 = ArchSql.ReportStatement(
    query_string="SELECT * FROM CHILDREN(SELECT * FROM document)",
    is_pipelined=True
)

# Statement 4: Filter the final list to keep only the doors.
# This runs on the output of stmt3.
# Final Output: [Door_Object]
stmt4 = ArchSql.ReportStatement(
    query_string="SELECT * FROM document WHERE IfcType = 'Door'",
    is_pipelined=True
)

# Step 2: Execute the full pipeline.
pipeline_statements = [stmt1, stmt2, stmt3, stmt4]
doors_on_floor = Arch.selectObjectsFromPipeline(pipeline_statements)

# The result is the final list of door objects.
FreeCAD.Console.PrintMessage(f"Found {len(doors_on_floor)} doors on the ground floor.\n")
for door in doors_on_floor:
    FreeCAD.Console.PrintMessage(f"- {door.Label}\n")
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
=== Inspecting and sharing a report via the Python Console ===
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
For debugging, scripting, or sharing your work with others, you can get a complete, human-readable summary of a Report's configuration directly from the Python Console.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
The custom logic and detailed content of a BIM Report are stored in its '''proxy object'''. Accessing the {{Incode|.Proxy}} attribute provides a full printout of all statements and their SQL queries. This is a convenient way to copy your entire report definition to the clipboard to share in a forum or a bug report.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
'''How to use it:'''
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
# Select your Report object in the Tree View.
# Press {{KEY|Ctrl}}+{{KEY|Shift}}+{{KEY|P}}. This will send the selected object to the Python Console as the variable {{Incode|obj}}.
# In the console, type the following and press Enter:
</div>

{{Code|code=
print(obj.Proxy)
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Example Output:'''
</div>

{{Code|code=
>>> print(obj.Proxy)
BIM Report: 'My Door Schedule' (2 statements)

--- Statement [1]: Find All Walls on Ground Floor ---
    SELECT * 
    FROM CHILDREN(SELECT * FROM document WHERE Label = 'Ground Floor')
    WHERE IfcType = 'Wall'

--- Statement [2]: Final Door Schedule (Pipelined, Header) ---
    SELECT
        Tag,
        COUNT(*) AS "Count"
    FROM
        document
    GROUP BY
        Tag
}}


{{Docnav/fr
|[[BIM_Material/fr|Matériau]]
|[[Arch_Schedule/fr|Nomenclature]]
|[[BIM_Workbench/fr|Atelier BIM]]
|IconL=BIM_Material.svg
|IconR=Arch_Schedule.svg
|IconC=Workbench_BIM.svg
}}

{{BIM_Tools_navi{{#translation:}}}}
{{Userdocnavi{{#translation:}}}}