<languages/>

{{Macro/fr
|Nom=Macro Cut Object for Magnets
|Nom/fr=Macro Cut Object for Magnets
|Icône=Macro_Cut_Object_For_Magnets.png
|Description=Découpe un objet suivant un plan et ajoute des trous alignés pour aimants avec détection de collision de surface. Crée deux pièces avec des trous parfaitement alignés pour y insérer des aimants qui permettent aux pièces de s'emboîter.
|Auteur=Sean P. Kane
|Version=0.6.1
|Date=2026-01-12
|FCVersion=0.19+
|Téléchargement=[https://wiki.freecad.org/images/thumb/e/e3/Macro_Cut_Object_For_Magnets.png/48px-Macro_Cut_Object_For_Magnets.png Icône de la barre d'outils]
|Voir aussi=[[Part_Slice/fr|Part Séparer en composés]], [[PartDesign_Hole/fr|PartDesign Perçage]]
}}

==Description==

Cette macro découpe un objet 3D selon un plan spécifié et ajoute automatiquement des trous magnétiques alignés aux deux pièces obtenues. Les trous sont positionnés à l'aide d'une détection de collision intelligente afin de garantir qu'ils ne traversent pas les parois extérieures de l'objet.

Cela est particulièrement utile pour :
* Créer des impressions en plusieurs parties qui s'assemblent à l'aide d'aimants intégrés.
* Diviser des objets volumineux pour les adapter à des plateaux d'imprimantes 3D plus petits tout en conservant leur alignement.
* Ajouter des mécanismes de fermeture magnétiques à des boîtiers et des étuis.

'''Principales fonctions :'''
* Découpe suivant des plans prédéfinis (XY, XZ, YZ) ou des plans de référence du modèle.
* Placement automatique des trous avec une répartition uniforme le long du bord de coupe.
* La détection des collisions de surface empêche les trous de traverser les parois.
* Diamètre, profondeur et nombre de trous configurables.
* Paramètres de dégagement préféré et minimum des bords.
* Repositionnement intelligent des trous lorsque le placement initial ne satisfait pas aux contrôles de sécurité.
* Crée des objets PartDesign::Body avec des fonctions de trou paramétriques.
* Prend en charge la recoupe d'objets déjà coupés (conserve les trous existants).
* Sépare automatiquement les deux parties pour faciliter la visualisation.

<span id="Usage"></span>
==Utilisation==

# Ouvrez un document contenant l'objet que vous souhaitez découper.
# Vous pouvez sélectionner l'objet et/ou un plan de référence avant d'exécuter la macro.
# Exécutez la macro à partir de '''Macro → Macros → CutObjectForMagnets → Lancer'''.
# Dans la boîte de dialogue :
#* Sélectionnez le corps à découper dans le menu déroulant.
#* Choisissez le type de plan de découpe (Préréglé ou Plan du modèle).
#* Pour les plans prédéfinis, définissez le décalage par rapport à l'origine.
#* Configurez les paramètres des trous pour aimants :
#** '''Diameter''' : diamètre du trou (doit correspondre à la taille de votre aimant).
#** '''Depth''' : profondeur du trou à partir de la surface de découpe.
#** '''Number of Holes''' : nombre total de trous à créer.
#** '''Edge Clearance (Preferred)''' : distance idéale entre l'arrête du trou et la surface de l'objet.
#** '''Edge Clearance (Minimum)''' : dégagement minimum acceptable.
# Cliquez sur « Execute Cut ».

[[File:MacroCutObjectForMagnetsDialog.png|400px|center]]

<span id="Example"></span>
==Exemple==

Cette image montre un vase dans sa forme originale, puis après avoir été découpé plusieurs fois à l'aide de la macro. Des aimants peuvent ensuite être insérés dans l'objet, qui peut alors être réassemblé. Cet exemple visait à créer un vase « cassable » pour une représentation théâtrale, mais il existe de nombreuses autres utilisations potentielles.

[[File:CutObjectForMagnetsExample.png|400px|center]]

<span id="How_It_Works"></span>
==Fonctionnement==

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Cutting Process:'''
# Creates a large half-space box aligned with the cutting plane.
# Uses boolean operations to split the object into two parts.
# Creates PartDesign::Body containers for each half.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Hole Placement Algorithm:'''
# Calculates hole positions evenly distributed along the cut face perimeter.
# For each position, validates against BOTH parts (not just one).
# Uses preferred clearance first, falls back to minimum if needed.
# Checks for hole-to-hole spacing (minimum 2x diameter).
# Repositions holes that fail safety checks using multiple strategies:
#* Reduced clearance at same position.
#* Increased inset from edge.
#* Alternative positions along the perimeter.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
'''Safety Features:'''
* Creates test cylinders to check if holes would break through walls.
* Validates each hole against both the top and bottom parts.
* Skips holes that cannot be safely placed.
* Reports repositioned and skipped holes in the console.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
==Parameters==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
{| class="wikitable"
! Parameter !! Description !! Default
|-
| Plane Type || "Preset Plane" (XY/XZ/YZ) or "Model Plane" (datum plane) || Preset Plane
|-
| Offset || Distance from origin for preset planes || 0 mm
|-
| Diameter || Magnet hole diameter || 3 mm
|-
| Depth || Hole depth from cut surface || 3 mm
|-
| Number of Holes || Total holes to create || 6
|-
| Edge Clearance (Preferred) || Ideal distance from hole edge to object surface || 2 mm
|-
| Edge Clearance (Minimum) || Minimum acceptable clearance (used during repositioning) || 0.5 mm
|}
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
==Requirements==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
* FreeCAD 0.19 or later.
* An object with a solid shape (Part or PartDesign body).
* For model plane mode: a datum plane or object with planar faces.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
==Installation==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
# Download the macro file: [https://raw.githubusercontent.com/spkane/freecad-robust-mcp-and-more/refs/heads/main/macros/Cut_Object_for_Magnets/CutObjectForMagnets.FCMacro CutObjectForMagnets.FCMacro].
# Copy the file to your FreeCAD macro directory:
#* '''macOS''': {{FileName|~/Library/Application Support/FreeCAD/Macro/}}
#* '''Linux''': {{FileName|~/.local/share/FreeCAD/Macro/}}
#* '''Windows''': {{FileName|%APPDATA%/FreeCAD/Macro/}}
# Optionally, download the toolbar icon and place it in the same directory.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
==Tips==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
* '''Magnet sizing''': Measure your magnets carefully. Common sizes are 3mm, 5mm, and 6mm diameter.
* '''Add tolerance''': Consider adding 0.1-0.2mm to the diameter for easier magnet insertion.
* '''Depth planning''': Set hole depth slightly deeper than magnet height to ensure flush or recessed fit.
* '''Edge clearance''': For thin-walled objects, reduce the preferred clearance but keep minimum clearance high enough to prevent wall breakthrough.
* '''Re-cutting''': The macro detects existing magnet holes and preserves them when cutting already-cut parts.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
==Source Code==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
The full source code is hosted on GitHub:
* [https://github.com/spkane/freecad-robust-mcp-and-more/blob/main/macros/Cut_Object_for_Magnets/CutObjectForMagnets.FCMacro CutObjectForMagnets.FCMacro on GitHub]
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
==Script==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
ToolBar Icon [[Image:Macro_Cut_Object_For_Magnets.png]]
</div>

'''Macro_Cut_Object_For_Magnets.FCMacro'''

{{CodeDownload|https://raw.githubusercontent.com/spkane/freecad-robust-mcp-and-more/refs/heads/main/macros/Cut_Object_for_Magnets/CutObjectForMagnets.FCMacro|CutObjectForMagnets.FCMacro}}

<div lang="en" dir="ltr" class="mw-content-ltr">
==Links==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
* [https://spkane.github.io/freecad-robust-mcp-and-more/ Full Documentation] - Complete guides and tutorials.
* [https://github.com/spkane/freecad-robust-mcp-and-more GitHub Repository] - Source code and issue tracker.
* [[Part_Slice|Part Slice]] - FreeCAD's built-in slice tool.
* [[PartDesign_Hole|PartDesign Hole]] - Parametric hole feature documentation.
* [[PartDesign_Body|PartDesign Body]] - Body container documentation.
</div>