<languages/>

{{TutorialInfo/de
|Topic=FEM
|Level=fortgeschrittener Anfänger
|Time=1 Stunde
|Author=[[User:M42kus|M42kus]]
|FCVersion=0.17
|Files=
}}

Der Arbeitsbereich FEM unterstützt schon viele unterschiedliche Randbedingungen und mehrere Berechnungsprogramme (Löser). Trotzdem brauchen Anwender oft Randbedingungen, die noch nicht von FreeCAD unterstützt werden. Diese Seite ist Startpunkt für eine Reihe von Anleitungen und anderen Quellen, die beschreiben, wie der Arbeitsbereich FEM mit dem vorhandenen Framework (<-?) erweitert werden kann. Während diese Reihe auch für Software-Entwickler hilfreich sein kann, ist die Idee dahinter, dass FEM-Anwender mit etwas Interesse für Python-Programmierung ermöglicht wird, selbst hinzuzufügen, was sie brauchen.

Neue Beschränkungen, Gleichungen oder Löser hinzuzufügen ist hauptsächlich Routinearbeit. Aber beim ersten Mal ist es wahrscheinlich nicht so einfach, wie es aussieht. Ein Verständnis für die folgenden Themen wird hilfreich sein:

* Python-Skripting in FreeCAD.
** [[Python_scripting_tutorial/de|Tutorial Skripterstellung mit Python]]
** [[FreeCAD_Scripting_Basics/de|Grundlagen der Skripterstellung in FreeCAD]]
* FreeCAD mit Python erweitern.
** [[Scripted_objects/de|Skriptgenerierte Objekte]]
* Ein grundlegendes Verständnis des Lösers, für den neue Objekte hinzugefügt werden sollen (z. B. CalculiX oder Elmer), ist wichtig.
* Ein wenig Wissen über Build-Systeme, insbesondere CMake (das von FreeCAD verwendete Build-System).

<span id="Build_System_(cmake)"></span>
== Build-System (cmake) ==

Das Build-System muss unabhängig davon geändert werden, welche Objekte zum Arbeitsbereich FEM hinzugefügt werden sollen. Jedes Python-Modul (Datei) muss registriert werden. Der Arbeitsbereich FEM erfordert, dass jedes neue Python-Modul in {{incode|Mod/Fem/CMakeLists.txt}} registriert wird. Dies gilt unabhängig vom Typ des Python-Moduls (GUI oder Nicht-GUI). Wo genau das Modul eingefügt werden muss, hängt von der Rolle des Moduls ab. Löser, Gleichungen und Beschränkungen verwenden alle unterschiedliche Listen. Meistens funktioniert es, nach ähnlichen Dateien zu suchen und die neue Datei in dieselbe Liste einzufügen.

Als '''Beispiel''' fügen wir eine neue Einschränkung namens {{incode|pressure}} hinzu, die mit der '''Strömungsgleichung''' zusammenhängt. Daher wird '''FlowPressure''' häufig als Name für diese Beschränkung verwendet. Eine neue Beschränkung erfordert mindestens die folgenden neuen Module:
* {{incode|constraint_<name>.py}}
* {{incode|view_constraint_<name>.py}} 
* {{incode|CommandFemConstraint<name>.py}} (kann unnötig sein) 
Diese drei Dateien müssen zu {{incode|Mod/Fem/CMakeLists.txt}} hinzugefügt werden, genauso wie  {{incode|Mod/Fem/App/CMakeLists.txt}}. Alle eingefügten Codezeilen werden durch einen Startbefehl gekennzeichnet. '''+'''.

{{FileName|Mod/Fem/CMakeLists.txt}}

{{code|code=
SET(FemObjects_SRCS
    femobjects/__init__.py
    femobjects/base_fempythonobject.py
    femobjects/constraint_bodyheatsource.py
    femobjects/constraint_electrostaticpotential.py
    femobjects/constraint_flowvelocity.py
    femobjects/constraint_initialflowvelocity.py
+   femobjects/constraint_initialflowpressure.py
    femobjects/constraint_selfweight.py
...
    femobjects/solver_ccxtools.py
)
...
SET(FemGuiViewProvider_SRCS
    femviewprovider/__init__.py
    femviewprovider/view_base_femconstraint.py
    femviewprovider/view_base_femobject.py
    femviewprovider/view_constraint_bodyheatsource.py
    femviewprovider/view_constraint_electrostaticpotential.py
    femviewprovider/view_constraint_flowvelocity.py
+   femviewprovider/view_constraint_flowpressure.py
    femviewprovider/view_constraint_initialflowvelocity.py
    femviewprovider/view_constraint_selfweight.py
...
    femviewprovider/view_solver_ccxtools.py
)
}}

<span id="Source_Organization"></span>
== Quellorganisation ==

Zur Organisation des Python-Codes verwendet das FEM-Modul den folgenden Ansatz. Das Modul ist in die folgenden Pakete unterteilt:
* {{incode|femobjects}}, das alle nicht-GUI-ähnlichen Python-Proxys für Dokumentobjekte enthält, und
* {{incode|femviewproviders}}, das alles GUI-bezogene wie Python-Proxys für View-Provider enthält
* C++-basierte Aufgabenfelder werden in '{{incode|Gui}}' gespeichert,
* Symbole finden sich in '{{incode|Gui/Resources/icons/}}',
* .ui-Dateien werden in '{{incode|Gui/Resources/ui/}}' gespeichert.

Ein Paket folgt diesem Muster nicht: {{incode|femsolver}}. Es befindet sich auf derselben Ebene wie {{incode|femobjects}} und {{incode|femguiobjects}} ({{incode|src/Mod/Fem/femsolver}}). Das Paket enthält Löser- und Gleichungs-bezogene Pakete und Module und ist wie folgt organisiert:

<pre>
.femsolver
.femsolver.elmer
.femsolver.elmer.equations
.femsolver.calculix
.femsolver.calculix.equations
.femsolver.z88
.femsolver.z88.equations
</pre>

<span id="Solver"></span>
== Löser ==

In FreeCAD kann ein Löser in zwei Teile unterteilt werden:
* Der eine Teil ist das Dokumentobjekt, das vom Benutzer zur Interaktion mit dem Löser verwendet wird. Über dieses Objekt können die Löser-Parameter eingestellt und der Lösungsprozess gesteuert werden. 
* Der andere Teil sind die sogenannten Aufgaben eines Lösers. Der Lösungsprozess ist in diese Aufgaben unterteilt, nämlich: ''Prüfen, Vorbereiten, Lösen und Ergebnisse''. Diese übernehmen die eigentliche Arbeit, indem sie die Analyse in ein Format exportieren, das vom Löser-Programm verstanden wird, das Programm starten und die Ergebnisse wieder in FreeCAD laden.

Die meisten Dateien, die sich auf einen Löser beziehen, befinden sich in einem Unterpaket des Pakets {{incode|femsolver}} (z. B. für Elmer in {{incode|femsolver/elmer}}). Die folgende Liste enthält alle Dateien, die mit der Implementierung eines Lösers zusammenhängen. Dies sind die Dateien, die kopiert und geändert werden müssen, um FreeCAD um einen neuen Löser zu erweitern. Das angegebene Beispiel stammt aus der Löser-Implementierung von Elmer. 

* '''femsolver/elmer/solver.py:''' Dokumentobjekt in der Baumansicht sichtbar. Implementiert in Python über einen Dokument-Proxy und einen Ansichts-Proxy.
* '''femsolver/elmer/tasks.py:''' Modul, das eine Aufgabenklasse pro Aufgabe enthält, die für eine Löser-Implementierung erforderlich ist. Diese Aufgaben unterteilen den Prozess der Lösung einer Analyse in die folgenden Schritte: Prüfen, Vorbereiten, Lösen, Ergebnisse.
* '''femcommands/commands.py:''' Fügt das Löser-Dokumentobjekt zum aktiven Dokument hinzu. Erforderlich, um über die Grafische Benutzeroberfläche auf das Löser-Objekt zuzugreifen.

<span id="Equations"></span>
==Gleichungen==

Eine Gleichung repräsentiert eine bestimmte physikalische Größe, die bei der Lösung der Analyse berücksichtigt werden muss (z. B. Strömung, Wärme). Nicht alle Löser in FreeCAD unterstützen (alle) Gleichungen. Gleichungen werden durch untergeordnete Objekte des entsprechenden Löser-Objekts dargestellt. In der Baumansicht sieht dies wie folgt aus:

* Elmer-Löser
** Elastizität
** Wärme
** Strömung
** Elektrostatik

Die meisten löserspezifischen Optionen (z. B. maximale Iterationen, Lösungsmethode usw.) werden über die Gleichungsobjekte festgelegt. Eine Folge davon ist, dass jeder Löser seine eigene Implementierung derselben Gleichung haben muss. CalculiX hätte ein anderes Wärmeobjekt als Elmer. Um zu vermeiden, dass in der GUI mehrere Schaltflächen für dieselbe Physik vorhanden sind, fügt jedes Löserobjekt seine Gleichungen selbst hinzu.

Die eigentliche Implementierung kann in einen generischen und einen löserspezifischen Teil unterteilt werden. Der generische Teil befindet sich im Modul {{incode|femsolver.equationbase}}. Der löserspezifische Teil befindet sich in einzelnen Equations-Unterpaketen der Löserpakete (z. B. {{incode|femsolver/elmer/equations}}).

Das Hinzufügen neuer Gleichungen zu Elmer sollte sehr einfach sein. Für Neulinge gibt es ein Tutorial, das zeigt, wie man eine neue Gleichung zu Elmer hinzufügt, indem man den vorhandenen Elastizitätslöser zu FreeCAD hinzufügt: [[Add_FEM_Equation_Tutorial/de|Tutorial FEM Gleichung hinzufügen]].

<span id="Constraints"></span>
==Beschränkungen==

Beschränkungen definieren Randbedingungen für das zu lösende Problem. In FreeCAD sind Beschränkungen nicht spezifisch für einen bestimmten Löser. Eine Problemkonfiguration kann von allen Lösern gelöst werden, die alle Bedingungen in der Analyse unterstützen.

Das Hinzufügen neuer Einschränkungen ist recht einfach. Für Neulinge gibt es ein Tutorium.: [[Add_FEM_Constraint_Tutorial/de|Tutorium FEM-Beschränkung hinzufügen]].


[[Category:FEM{{#translation:}}]]