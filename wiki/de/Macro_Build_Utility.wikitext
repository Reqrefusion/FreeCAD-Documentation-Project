<languages/>

{{Macro/de
|Name=Dienstprogramm Zusammenbau
|Description=Dieses Makro stellt ein Build-Dienstprogramm bereit, mit dem mehrere Projektdateien zu einer Projektdatei zusammengefügt werden können.
|Author=Piffpoof
|Version=1.0
|Date=2015-01-21
|FCVersion=Alle
|Download=[https://wiki.freecad.org/images/8/87/Macro_Build_Utility.png Werkzeugleisten-Symbol]
}}

<span id="Description"></span>
==Beschreibung==

Dieses Makro ist für den Einsatz in großen Projekten mit Hunderten von Objekten vorgesehen. Seine Verwendung in einem kleinen Projekt mit nur einer Datei wäre sinnlos und unnötig. Bei einem großen Projekt mit vielen Objekten und vielen Dateien, die zu einer endgültigen Datei zusammengeführt werden müssen, spart es jedoch Zeit, erspart dem Benutzer wiederholte Aktionen und verhindert menschliche Fehler.

==Installation==

Der gesamte Code für buildUtility.FCMacro befindet sich in einem Makro. Die Installation besteht also darin, den Code in das entsprechende Makroverzeichnis zu kopieren und pythonAssistantWindow über das Makro-Menü, die Python-Konsole oder eine Symbolleisten-Schaltfläche (die bevorzugte Methode) aufzurufen.
* Siehe [[How to install macros/de]] über Informationen zur Installation dieses Makro-Codes
* Siehe [[Customize Toolbars/de]] über Informationen zur Installation als Schaltfläche in einer Symbolleiste

<span id="Usage"></span>
==Anwendung==

Das Build-Dienstprogramm funktioniert nach denselben Prinzipien wie die Build-Dateien, die zum Zusammenstellen großer Softwaresysteme (wie FreeCAD) verwendet werden. Mit einem Texteditor wird eine Textdatei erstellt, die den vom Build-Dienstprogramm geforderten Formaten entspricht. Das Build-Dienstprogramm liest dann einfach jede Zeile der Textdatei und führt die in dieser Textdatei angegebenen Aktionen aus.

<div lang="en" dir="ltr" class="mw-content-ltr">
The macro asks the user for a "build file". It then parses that build file, there are 3 legal line types:
* lines starting with the comment character "#" which are ignored as being comments or remarks
* lines starting with the subfile character "@" which are ignored<br /><b>Note</b>: the "@" character is for future enhancement when sub-build files will be handled
* all other lines which may be a project file or a sub-directory
</div>

Die Dateiendung für Build Utility-Dateien lautet „.FCBld“. Dadurch wird verhindert, dass diese Dateien mit anderen Verwendungszwecken und Anwendungen verwechselt werden.

<div lang="en" dir="ltr" class="mw-content-ltr">
Any file specified in the build file is assumed to have the extension ".FCStd"
If the line starts with a directory then the project file is read from that subfolder. Otherwise it is assumed the line specifies a project file. Directories within directories are supported so nesting of arbitrary depths is possible. The file specification format is the "Unix" style with different levels separated by the forward slash character "/".
</div>

Jede fehlende Datei wird in der Ausgabefenster ausgegeben. Jedes fehlende Verzeichnis wird in der Ausgabefenster ausgegeben.

<div lang="en" dir="ltr" class="mw-content-ltr">
A new document is created and each project is "Project Merged" into that new and empty document.
The document is not saved at the end, this is left for the user if desired.
If the file does not exist then the file name is Printed to the Report view
</div>

<span id="User_Interface"></span>
==Benutzeroberfläche==

Für dieses Makro gibt es überhaupt keine grafische Benutzeroberfläche. Das Makro liest eine mit einem Texteditor erstellte Textdatei und erstellt ein Modell in einem Ausgabedokument. Abgesehen vom Klicken auf die Schaltfläche in der Symbolleiste, um den Vorgang zu starten, ist keine Benutzerinteraktion erforderlich.

<span id="Options"></span>
==Optionen==

Es gibt keine grafische Benutzeroberfläche, daher gibt es auch keine Optionen. Die einzigen Alternativen bestehen darin, die drei oben beschriebenen Zeilentypen in der Textdatei zu verwenden.

<span id="Remarks"></span>
==Anmerkungen==

Um noch einmal zu wiederholen, was zu Beginn gesagt wurde: Bei einem kleinen Modell mit nur einer Datei ist diese Makrofunktion nutzlos. Für Personen, die Flugzeuge, Lokomotiven, Schiffe, Gebäude, physikalische Anlagen oder komplexe Schaltkreise modellieren, bietet es jedoch einen eindeutigen Nutzen und Vorteil. Durch die Wahl der Dateiendung „.FCBld“ soll eine Art Standard für Build-Dateien innerhalb von FreeCAD geschaffen werden. Durch die Reservierung des Präfixzeichens „@“ in der Befehlsdateidefinition soll die zukünftige Verwendung und (falls erforderlich) Erweiterung ermöglicht werden.

<span id="Links"></span>
==Verweise==

keine (so weit)

<span id="Script"></span>
==Skript==

Werkzeugleisten-Symbol [[Image:Macro_Build_Utility.png]]

'''Macro_Build_Utility.FCMacro'''

{{MacroCode|code=
#
#						Build Utility
#                       v 0.0 - build from files and files in sub-folders
#
#***********************************************************************************
# routine to read in a build file and merge all specified projects
"""
This function asks the user for a "build file". It then parses that build file, there
are 3 legal line types:
- lines starting with the comment character "#" which are ignored
- lines starting with the subfile character "@" which are ignored
	Note:	the "@" character is for future enhancement when sub-build files 
			will be handled
- all other lines which may be a project file or a subfolder (sub-directory)
If the line is a subfolder then the project file is read from that subfolder.
Otherwise it is assumed the line specifies a project file.
A new document is created and each project is "Project Merged" into that new and empty document.
The document is not saved at the end, this is left for the user if desired.
If the file does not exist then the file name is Printed to the Report view
"""
"""
Example file:
#this is a sample build file
#==============================
@sub-build-files - not presently inplemented
# first the top-level file
metal
# now some misc files
./black/black
./blue/blue
# file does not exist
zebra 
# folder does not exist
/bear/bear
# multiple files in one sub-folder
./engineering/green
./engineering/grey
#multiple files in hierarchical folders
./externalModules/white
./externalModules/red/red
#./externalModules/red/stackerAssembly - commented out as not currently loading
./externalModules/red/orange
./externalModules/red/level3/yellow
"""
# import statements
import FreeCAD
import os.path
from PySide import QtGui

# UI Class definitions

# Class definitions

# Function definitionss

# Constant definitions
buildTargetDocument = "build_target"
commentTag = "#"
subfileTag = "@"
lineFeed = "\n"
subfolder = "./"
carriageReturn = "\r"
fileSeparator = "/"
fcFileExtension      = ".FCStd"
fcFileExtensionUC  = ".FCSTD"
fcFileExtensionLen = -6

# code ***********************************************************************************
buildFilePathName=QtGui.QFileDialog.getOpenFileName()[0]
if len(buildFilePathName) > 0:
	# set up a new empty "build_target" document
	FreeCAD.newDocument(buildTargetDocument)
	FreeCAD.setActiveDocument(buildTargetDocument)
	FreeCAD.ActiveDocument=FreeCAD.getDocument(buildTargetDocument)
	guiDoc=FreeCADGui.ActiveDocument
	#
	lastFileSeparator = buildFilePathName.rindex(fileSeparator)
	buildFilePath = buildFilePathName[: lastFileSeparator]
	buildFileName = buildFilePathName[lastFileSeparator +1:]
	#
	buildFileContents = open(buildFilePathName,"r")
	buildFileLines = buildFileContents.readlines()
	buildFileContents.close()
	#
	for line in buildFileLines:
		if line[0] == commentTag:
			# line of internal comment
			pass
		elif line[0] == subfileTag:
			# line of sub-build-file (not presently implemented)
			pass
		else:
			# a line which should specify a FreeCAD project file
			# - may be preceded by a sub-directory e.g. "./subdir309/"
			# - project file may be missing file extension
			#
			# if line break at end of file spec then remove
			if line[-1:] == lineFeed:
				line = line[:-1]
			if line[-1:] == carriageReturn:
				line = line[:-1]
			# if no FreeCAD project file extension supplied then append one
			# make an uppercase comparison in case of mixed case
			tempLine = fcFileExtension + line.upper()
			if fcFileExtensionUC != tempLine[fcFileExtensionLen:]:
				line = line + fcFileExtension
			# if there is a leading subdirectory then remove "./" from beginning
			if subfolder[0:2] == line[0:2]:
				line = line[2:]
			projectFileSpec = str(buildFilePath) + str("/") + str(line)
			if os.path.exists(projectFileSpec):
				guiDoc.mergeProject(projectFileSpec)
			else:
				FreeCAD.Console.PrintMessage('project file "' + projectFileSpec + '" not found' + "\n")

	# set view back to "build_target", it is up to user to save it (if they want)
	FreeCAD.setActiveDocument(buildTargetDocument)
	FreeCAD.ActiveDocument=FreeCAD.getDocument(buildTargetDocument)
	FreeCADGui.ActiveDocument=FreeCADGui.getDocument(buildTargetDocument)
	FreeCADGui.SendMsgToActiveView("ViewFit")
	FreeCADGui.activeDocument().activeView().viewAxometric()
#
#OS: Mac OS X
#Word size: 64-bit
#Version: 0.14.3703 (Git)
#Branch: releases/FreeCAD-0-14
#Hash: c6edd47334a3e6f209e493773093db2b9b4f0e40
#Python version: 2.7.5
#Qt version: 4.8.6
#Coin version: 3.1.3
#SoQt version: 1.5.0
#OCC version: 6.7.0
#
#thus ends the macro...
}}


<div lang="en" dir="ltr" class="mw-content-ltr">
==Example==
You are working with some other departments in your company to use FreeCAD to generate a large CAD model for an external client. To prepare for the upcoming presentation you need to integrate the models represented in the 'black' and 'blue' subsystems, the engineering department has responsibility for the 'green' and 'grey' subsystems and you have the 'metal' subsystem on your own computer. The client also uses FreeCAD and your design must integrate with their subsystems "red', and 'yellow'. The external client has told you that the Stacker Assembly is not ready for you to use so you comment it out in your build file.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
There are a lot of directory paths to type in so you enter the commands into the Build Utility text file which means you can run it with a single click on a toolbar button.
</div>

[[File:MacroBuildUtilityTreeDiagram.jpg|500px]]

<div lang="en" dir="ltr" class="mw-content-ltr">
The contents of the build file "buildFile.FCBld" shown below shows the file structure for the project described above.
</div>

{{Code|code=
#this is the build file for the complete assembly
#==============================
@sub-build-files - not presently implemented
# first the top-level file
metal
# now some misc files
./black/black
./blue/blue
# file does not exist
zebra 
# folder does not exist
/bear/bear
# multiple files in one sub-folder
./engineering/green
./engineering/grey
#multiple files in hierarchical folders
./externalModules/white
./externalModules/red/red
#./externalModules/red/stackerAssembly - commented out as not currently loading
./externalModules/red/orange
./externalModules/red/level3/yellow
}}
<div lang="en" dir="ltr" class="mw-content-ltr">
A summary of the file and how it is processed is:
* the first two lines are treated as comments and everything following the initial character of the hash sign is ignored
</div>
{{Code|code=
#this is the build file for the complete assembly
#==============================
}}
<div lang="en" dir="ltr" class="mw-content-ltr">
* the third line is also ignored because it's first character is the ampersand character which is reserved for future use where command files can invoke other commend files
</div>
{{Code|code=
@sub-build-files - not presently implemented
}}
<div lang="en" dir="ltr" class="mw-content-ltr">
* the fifth line is the first file specification, the file is in the same directory as the build file, not in a sub-directory
</div>
{{Code|code=
metal}}
* Die siebte und achte Zeile sind beide Dateispezifikationen, bei denen sich die Datei in einem Unterverzeichnis befindet. Man beachte, dass das Unterverzeichnis die Form "./black/" hat, wobei "black" der Name des Verzeichnisses ist. Eine Datei namens "sheetFold.FCstd" im Verzeichnis "outsourcing" würde also als "./outsourcing/sheetFold" erscheinen.
{{Code|code=
./black/black
./blue/blue}}
* Die neunzehnte Zeile zeigt eine Dateispezifikation, die zwar existiert, aber nicht in diesen Build-Vorgang einbezogen wird
{{Code|code=
#./externalModules/red/stackerAssembly - commented out as not currently loading}}
* Die letzten beiden Zeilen zeigen Dateispezifikationen, bei denen sich die Datei in mehr als einer Ebene eines Unterverzeichnisses befindet.
{{Code|code=
./externalModules/red/orange
./externalModules/red/level3/yellow
}}



{{clear}}